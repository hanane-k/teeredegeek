(function(win,$){$.init("BlocAddToWishListHeart",function(opt){var settings=$.extend({addProductLinkUrl:'',addProductToWishListHeartPopinUrl:'',checkAddProductLinkUrl:'',createNewListText:'',createWishListUrl:'',loginUrl:'',moveProductFromWishListToAnotherUrl:'',removeProductFromWishListUrl:'',maxItemsInWishList:50},opt),_doc=win.document,$BlocAddToWishListHeart=$('#BlocAddToWishListHeart'),$WhishListActive=$('#inputWishlistHeart'),$wishListDisplayPopinForm=$('#wishListDisplayPopinForm'),$popinVariantError=$('#popinVariantError');$popinVariantError.hide();if($.isTouch()){$BlocAddToWishListHeart.hide()}if($.nav.session.isAuthenticate()){$.ajax({url:settings.checkAddProductLinkUrl,cache:false,data:$wishListDisplayPopinForm.serialize(),dataType:"html",type:'GET',success:function(res){if(res!="null"){$WhishListActive[0].checked=true;var popin=_doc.createElement("div");popin.className="popin WlPopinHeart jsWlPopinHeart WlPopinHeartTemp";$(popin).hide();$BlocAddToWishListHeart.append(popin);var option={callback:callbackPopin,data:$wishListDisplayPopinForm.serialize(),isWaitingOverlayHidden:true,isOverflowHidden:false,isHidden:true};$.popin.loadAjaxPopin(settings.addProductLinkUrl,option)}}})}var callbackPopin=function(){$.popin.hideOverlay();InitListingWishList(_doc,settings);return false};var clickEventType=((document.ontouchstart!==null)?'click':'touchstart');$(".jsInputWishlistHeart",$BlocAddToWishListHeart).on(clickEventType,function(event){var $InputHeart=$(this),$layerTemp=$('.WlPopinHeartTemp',$BlocAddToWishListHeart);if($.nav.session.isAuthenticate()){if(!$WhishListActive[0].checked&&$layerTemp.length==0){var variant=validateSelection($(this).parent());if(!variant.isValide){$(".jsWishlistHeart").addClass("WishlistHeartError");if(clickEventType=="touchstart"){$(this).mouseenter()}$popinVariantError.show();return false}$InputHeart.finish();$InputHeart.animate({"background-size":"120%"},230).animate({"background-size":"100%"},230);$(".jsWishlistHeart").removeClass("WishlistHeartError");var popin=_doc.createElement("div");popin.className="popin WlPopinHeart jsWlPopinHeart WlPopinHeartTemp";$BlocAddToWishListHeart.append(popin);var option={callback:callbackPopin,data:$wishListDisplayPopinForm.serialize(),isWaitingOverlayHidden:true,isOverflowHidden:false};$.popin.loadAjaxPopin(settings.addProductLinkUrl,option);$(popin).show()}else{if(clickEventType=="touchstart"&&!$layerTemp.is(":visible")){$layerTemp.show();event.preventDefault();$(this).mouseenter()}else{$.ajax({url:settings.removeProductFromWishListUrl,cache:false,data:$wishListDisplayPopinForm.serialize(),dataType:"html",type:'GET',success:function(res){if(res!="null"){$layerTemp.remove()}}})}}}else{window.location.href=settings.loginUrl}}).mouseenter(function(e){$(this).finish();if(!$(this).is(":animated")){$(this).animate({"background-size":"100%"},230)}}).mouseleave(function(e){$(this).finish();if(!$(this).is(":animated")){$(this).animate({"background-size":"80%"},230)}});$BlocAddToWishListHeart.mouseleave(function(){var validLayer=$('.jsWlPopinHeart',$BlocAddToWishListHeart),errorLayer=$('#popinVariantError');if($('.jsWlPopinHeart',$(this)).length>0)toggleLayer(validLayer,true);else toggleLayer(errorLayer,true)}).mouseenter(function(){var validLayer=$('.jsWlPopinHeart',$BlocAddToWishListHeart);if($('.jsWlPopinHeart',$(this)).length>0)toggleLayer(validLayer,false)});$("body").on("click",".jsCancelCreation",function(){var $BlocAddToWishListHeart=$('#BlocAddToWishListHeart'),$WhishListActive=$(".jsInputWishlistHeart",$BlocAddToWishListHeart);$.popin.hideOverlay()}).on("focusin",".jsWlHeartCreateTitle input",function(){$('#WlHeartPopinList .jsWlHeartCreationFailed').remove();var $errorMessage=$(this).next(),$placeholderAbove=$(this).parent().prev();$placeholderAbove.addClass("WlHeartCreateDisplayBlock");$("#WishListCreationFormData_WishListName").removeClass("error").removeClass("WlHeartCreateTitleRedUnderline");$(this).attr("placeholder","");if($errorMessage.is(":visible")){$errorMessage.removeClass("WlHeartCreateDisplayBlock")}}).on("focusout",".jsWlHeartCreateTitle input",function(){var $thisValue=$(this).val(),$placeholderAbove=$(this).parent().prev();if($thisValue.trim()==""){$placeholderAbove.removeClass("WlHeartCreateDisplayBlock");if($thisValue!="")$(this).val("");$(this).attr("placeholder",settings.createNewListText)}}).touch(function(evt){var $HeartInput=$(".jsInputWishlistHeart",$BlocAddToWishListHeart);if(!$(evt.target).is($HeartInput)){$HeartInput.mouseleave()}})});function InitListingWishList(doc,settings){$('.jsWlListAccess').click(function(opt){var callbackPopinHeartList=function(){initFormWlHeart(settings);return false};var option={callback:callbackPopinHeartList,data:$('#wishListDisplayPopinForm').serialize(),isOverlayClick:true,fullSize:false,isOverflowHidden:true,isPopinFullScreen:true};$.popin.loadAjaxPopin(settings.addProductToWishListHeartPopinUrl,option)})};var initFormWlHeart=function(settings){var $Body=$("body"),$popinList=$('#WlHeartPopinList'),$popinListContent=$('.jsWlHeartListContent',$popinList),$popinListCreationBloc=$('.jsWlHeartCreateNewList',$popinList);$Body.each(function(){$(this).on("click",".jsWlHeartListAccess",function(evt){evt.stopPropagation()});$(this).on("click",".popinFull",function(evt){if(!$('.jsWlHeartMaxCountReachedMessage').hasClass('WlHeartMaxCountReachedHidden')){$('.jsWlHeartMaxCountReachedMessage').addClass('WlHeartMaxCountReachedHidden');$('.jsWlHeartList.WlHeartListRedBorder',$popinList).removeClass('WlHeartListRedBorder')}});$(this).on("click",".jsWlHeartBlockList li",function(evt){if($(".jsWlHeartText>span",$(this))[0].innerText.split('(').pop().replace(')','')>=settings.maxItemsInWishList&&!$(this).find("#SelectedListId").checked){evt.preventDefault();evt.stopPropagation();$('.jsWlHeartMaxCountReachedMessage').removeClass('WlHeartMaxCountReachedHidden');$(evt.target).parents(".jsWlHeartList").addClass('WlHeartListRedBorder');$('.jsWlHeartList.WlHeartListRedBorder',$popinList).not($(evt.target).parents('.jsWlHeartList.WlHeartListRedBorder')).removeClass('WlHeartListRedBorder');return}var $FormWlHeart=$(".jsWlHeartBlockList",$Body);var $checkedElem=$(evt.target);var checkTriggered=!$checkedElem.hasClass("jsOverlayContent")&&!$checkedElem.parents(".jsOverlayContent").length>0;if(checkTriggered){var $selectedCheckbox=$(this).find('.jsWlHeartCheckbox input[type=checkbox]'),$newCheckedText=$('.jsWlHeartText>span',$(this));$previouslyChecked=$('li.jsWlHeartCheckedList',$FormWlHeart),$previouslyCheckedText=$('.jsWlHeartText>span',$previouslyChecked),incrOrDecr=function(text,flagIncrOrDecr){var strTab=text.toString().split('('),strTabLast=strTab.pop(),strTabCount=strTab.length,numberStr=strTabLast.substring(0,strTabLast.length-1),numberInt=Number(numberStr),res="";flagIncrOrDecr?numberInt++:numberInt--;numberStr=numberInt.toString();for(i=0;i<strTabCount;i++){res=res+strTab[i]+'('}res=res+numberStr+')';return res};$previouslyCheckedText[0].innerText=incrOrDecr($previouslyCheckedText[0].innerText,false);$newCheckedText[0].innerText=incrOrDecr($newCheckedText[0].innerText,true);$selectedCheckbox.prop('checked',true);$(this).addClass("WlHeartCheckedList jsWlHeartCheckedList");$('li',$FormWlHeart).not(this).find('.jsWlHeartCheckbox input[type=checkbox]').prop('checked',false);$('.jsWlHeartList',$FormWlHeart).not(this).removeClass("WlHeartCheckedList jsWlHeartCheckedList");return}});$('.jsWlHeartCreateButton',this).on('click',function(){var $errorBorder=$("#WishListCreationFormData_WishListName"),$errorText=$(this).prev().children().last(),$titleValue=$errorBorder.val().trim();if($titleValue==""){$errorBorder.addClass("WlHeartCreateTitleRedUnderline");$errorText.addClass("WlHeartCreateDisplayBlock")}else{var $form=$(this).parents("form");$form.ajaxSubmit({url:settings.createWishListUrl,data:$form.serialize(),dataType:"json",success:function(data){if(data){if(data.IsOperationSuccess){var callbackPopinHeartList=function(){initFormWlHeart(settings);$('#WlHeartPopinList .jsWlHeartList:eq(1)').click();return false};var option={callback:callbackPopinHeartList,data:$('#wishListDisplayPopinForm').serialize(),isOverlayClick:true,fullSize:false,isOverflowHidden:true,isPopinFullScreen:true};$('#overlay .jsCancel').click();$.popin.loadAjaxPopin(settings.addProductToWishListHeartPopinUrl,option);$("#WishListCreationFormData_WishListProductForm_WishListItemDataCount").val(data.WishListCount);$.getScript({text:data.Script})}else{$popinListCreationBloc.html(data.html);initFormWlHeart(settings);var $errorBorder=$("#WishListCreationFormData_WishListName");$errorBorder.addClass("WlHeartCreateTitleRedUnderline");$errorBorder.addClass("error")}}}})}});$('.jsWlValidateChanges',this).on('click',function(){var $form=$popinListContent.find('form');$.ajax({url:settings.moveProductFromWishListToAnotherUrl,cache:false,data:$form.serialize(),dataType:"json",type:'GET',success:function(res){if(res&&res.IsOperationSuccess){$firstPopin=$("#BlocAddToWishListHeart .jsWlPopinHeart");$firstPopin.html(res.html);InitListingWishList(win.document,settings)}}});$('.jsCancel','#overlay').click()});$('.jsWlHeartCreationTxt',$popinListCreationBloc).keydown(function(e){if(e.keyCode==13){event.preventDefault();$('.jsWlHeartCreateButton',$popinListCreationBloc).click()}})})};var timeOut;function toggleLayer(nameDiv,isVisible){if(isVisible){timeOut=setTimeout(function(){$(nameDiv).hide()},800);return true}else{clearTimeout(timeOut);$(nameDiv).show();return true}}})(window,window.jQuery||window.cm)