(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports={init:function(config){var html=config.get("html"),htmlWrapper=document.createElement("div");htmlWrapper.innerHTML=html,document.body.appendChild(htmlWrapper);for(var scripts=htmlWrapper.getElementsByTagName("script"),n=0;n<scripts.length;n++)eval(scripts[n].innerHTML)}};

},{}],2:[function(require,module,exports){
function pluginUrl(e){switch(e.get("environment")){case"production":return"//static.personali.com";case"development":return"//static.personali.dev:8881";default:return"//static-int1.personali.io"}}function initProductPagePlugin(e,t){window.netotiateInitScript=function(){Netotiate.Plugin.init({affiliateId:e.get("affiliate_id"),authenticationKey:e.get("authentication_key"),debug:!!e.get("debug"),pageType:t})};var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=pluginUrl(e)+"/scripts/plugin/plugin.library.min.js.jgz";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(r,a)}function initReadyStateHandler(hooks){var js=hooks;js&&""!=js&&(window.onNetotiateReadyState=function(){try{eval(js)}catch(e){}})}function initProductCheckoutPlugin(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=pluginUrl(e)+"/scripts/plugin/checkout.library.min.js.jgz";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r)}function initPixelCode(e){var t=e.get("confirmation_page_make_an_offer->items"),r=e.get("confirmation_page_make_an_offer->order_id");window.onNetotiatePluginCheckoutReadyState=function(){for(index in t)if(t.hasOwnProperty(index)){var a=t[index];a.personaliOfferId?Netotiate.Plugin.Api.Pixel.addNetotiate(a.personaliOfferId,a.sku,a.category,a.price,a.quantity,r):Netotiate.Plugin.Api.Pixel.add(a.sku,a.category,a.price,a.quantity,r)}Netotiate.Plugin.Api.Pixel.report(e.get("affiliate_id"),e.get("authentication_key"))}}function replaceQuoteWithGraveAccent(e){for(var t in e)"string"==typeof e[t]&&(e[t]=e[t].replace("'","`"));return e}function injectMultiProductPageDraw(e){for(var t=e.get("multi_products_page_make_an_offer->products_array"),r=0;r<t.length;r++){var a=t[r].element,n=t[r].appendType||"append";if(t.hasOwnProperty(r)){var i=t[r];if(i){var o={sku:i.sku,categoryId:i.categoryId,productPrice:i.productPrice,productTax:i.productTax,productImgUrl:i.productImgUrl,productTitle:i.productTitle,productDesc:i.productDesc,productAmp:i.productAmp,productBrand:i.productBrand,email:i.email,flex1:i.flex1,flex2:i.flex2,flex3:i.flex3,flex4:i.flex4,cartUrl:i.cartUrl,externalId:r+1};i.organicAddToCartButtonQuerySelector&&i.organicAddToCartButtonQuerySelector.trim()&&(o.organicAddToCartSelector=i.organicAddToCartButtonQuerySelector),o=replaceQuoteWithGraveAccent(o);var c=document.createElement("span");c.setAttribute("onclick","Netotiate.Plugin.draw("+JSON.stringify(o)+");"),appendElement(n,c,a)}}}}function injectDraw(e){var t={sku:e.get("single_product_page_make_an_offer->sku"),categoryId:e.get("single_product_page_make_an_offer->category"),productPrice:e.get("single_product_page_make_an_offer->product_price"),productImgUrl:e.get("single_product_page_make_an_offer->product_image_url"),productTitle:e.get("single_product_page_make_an_offer->product_title"),productAmp:e.get("single_product_page_make_an_offer->product_amp"),productBrand:e.get("single_product_page_make_an_offer->product_brand"),email:e.get("single_product_page_make_an_offer->email"),flex1:e.get("single_product_page_make_an_offer->flex1"),flex2:e.get("single_product_page_make_an_offer->flex2"),flex3:e.get("single_product_page_make_an_offer->flex3"),flex4:e.get("single_product_page_make_an_offer->flex4"),cartUrl:e.get("single_product_page_make_an_offer->cart_url"),waitFor:e.get("single_product_page_make_an_offer->wait_for")instanceof Array?JSON.stringify(e.get("single_product_page_make_an_offer->wait_for")):"[]"},r=e.get("single_product_page_make_an_offer->organic_add_to_cart_button_query_selector");r&&r.trim()&&(t.organicAddToCartSelector=r),t=replaceQuoteWithGraveAccent(t);var a=document.createElement("span");a.setAttribute("onclick","Netotiate.Plugin.draw("+JSON.stringify(t)+");");var n=findElement(e.get("single_product_page_make_an_offer->selector-type"),e.get("single_product_page_make_an_offer->selector-path")),i=e.get("single_product_page_make_an_offer->append_type");appendElement(i,a,n)}var findAllElements=function(e,t){var r;switch(e){case"_class":r=document.querySelectorAll("."+t);break;case"_path":r=document.querySelectorAll(t)}return r},findElement=function(e,t){var r;switch(e){case"_id":r=document.querySelector("#"+t);break;case"_class":r=document.querySelector("."+t);break;case"_path":r=document.querySelector(t)}return r},appendElement=function(e,t,r){if(r)switch(e){case"insert_after":r.parentNode.insertBefore(t,r.nextSibling);break;case"insert_before":r.parentNode.insertBefore(t,r);break;case"append":r.appendChild(t)}};module.exports={init:function(e){var t=e.get("page_type");switch("custom"==t&&(t=e.get("custom->custom_page_type")),e.get("integration_type")){case"single_product_page_make_an_offer":injectDraw(e),initReadyStateHandler(e.get("single_product_page_make_an_offer->event_hooks")),initProductPagePlugin(e,t);break;case"multi_products_page_make_an_offer":injectMultiProductPageDraw(e),initReadyStateHandler(e.get("multi_products_page_make_an_offer->event_hooks")),initProductPagePlugin(e,t);break;case"confirmation_page_make_an_offer":initPixelCode(e),initProductCheckoutPlugin(e,"confirmationPage")}}};
},{}],3:[function(require,module,exports){
var variables=require("./lib/variables")([{type:"constant",name:"affiliate_id",_id:"5798853265afeab32fc122d9",config:[{value:"132",name:"value"}]},{type:"constant",name:"auth_key",_id:"5798854065afeab32fc122da",config:[{value:"c8bb7e6b3440fc320d19f41710876ec8de24f4c9",name:"value"}]},{type:"data-layer",name:"sku",_id:"5798854f65afeab32fc122db",config:[{value:"sku",name:"var-name"}]},{type:"data-layer",name:"productPrice",_id:"579885bc65afeab32fc122dc",config:[{value:"productPrice",name:"var-name"}]},{type:"data-layer",name:"title",_id:"579885da65afeab32fc122dd",config:[{value:"productTitle",name:"var-name"}]},{type:"data-layer",name:"tax",_id:"579885e565afeab32fc122de",config:[{value:"productTax",name:"var-name"}]},{type:"data-layer",name:"image",_id:"579885ed65afeab32fc122df",config:[{value:"productImgUrl",name:"var-name"}]},{type:"data-layer",name:"brand",_id:"579885f665afeab32fc122e0",config:[{value:"productBrand",name:"var-name"}]},{type:"data-layer",name:"description",_id:"5798861765afeab32fc122e1",config:[{value:"productDesc",name:"var-name"}]},{type:"data-layer",name:"cartUrl",_id:"5798862465afeab32fc122e2",config:[{value:"cartUrl",name:"var-name"}]},{type:"data-layer",name:"categoryId",_id:"5798863465afeab32fc122e3",config:[{value:"categoryId",name:"var-name"}]},{type:"data-layer",name:"amp",_id:"5798863e65afeab32fc122e4",config:[{value:"productAmp",name:"var-name"}]},{type:"data-layer",name:"flex1",_id:"5799c68665afeab32fc122e9",config:[{value:"flex1",name:"var-name"}]},{type:"data-layer",name:"flex2",_id:"5799c69365afeab32fc122ea",config:[{value:"flex2",name:"var-name"}]},{type:"data-layer",name:"cart_subtotal",_id:"57a053b365afeab32fc122fd",config:[{value:"subtotal",name:"var-name"}]},{type:"data-layer",name:"cart_total",_id:"57a053bf65afeab32fc122fe",config:[{value:"total",name:"var-name"}]},{type:"data-layer",name:"cart_shipping",_id:"57a053cb65afeab32fc122ff",config:[{value:"shipping",name:"var-name"}]},{type:"data-layer",name:"cart_shipping",_id:"57a053cc65afeab32fc12300",config:[{value:"shipping",name:"var-name"}]},{type:"data-layer",name:"cart_tax",_id:"57a053d665afeab32fc12301",config:[{value:"tax",name:"var-name"}]},{type:"data-layer",name:"cart_items",_id:"57a053ea65afeab32fc12302",config:[{value:"items",name:"var-name"}]},{type:"data-layer",name:"page_type",_id:"57a0629d65afeab32fc12305",config:[{name:"var-name",value:"pageType"}]},{type:"js-function",name:"pixel_data",_id:"57ea329fb9147928149160e2",config:[{value:"",name:"parameter"},{value:'function(parameter) {  \r\n  var personaliItems = [];\r\n  if(typeof dataLayer[0] != "undefined" && dataLayer[0].hasOwnProperty("items")) {\r\n     var items = dataLayer[0].items;\r\n  } else {\r\n  \tvar items = personaliDataLayer[0].items;\r\n  }\r\n  for(index in items) {\r\n    if(items.hasOwnProperty(index)) {\r\n        var item = items[index];\r\n            var newItem = {};\r\n             newItem.sku = item.sku;\r\n             newItem.category = item.categoryid;\r\n             newItem.price = item.amount;\r\n             newItem.quantity = item.quantity;\r\n             personaliItems.push(newItem);\r\n    }\r\n  }\r\n\r\n  //document.cookie = \'p_data=;expires=Thu, 01 Jan 1970 00:00:01 GMT;Domain=.mvideo.ru;path=/\';\r\n  return personaliItems;\r\n}',name:"function"}]},{type:"global-js",name:"tracking_id",_id:"580876a1b914792814916105",config:[{name:"var-name",value:'tc_vars["sf_ords"][0]["id"]'}]},{type:"global-js",name:"title_tc_vars",_id:"58d3b1a63a21fe20082e8854",config:[{value:"tc_vars.pr_name",name:"var-name"}]},{type:"js-function",name:"nego2",_id:"58e381f13a21fe20082e885a",config:[{name:"parameter",value:""},{name:"function",value:'function(){\r\n\tvar item = $("#btnNegociate");\r\n    if(item.length > 0) {\r\n    \treturn "nego2";\r\n    } else {\r\n       return "no_nego2";\r\n    }\r\n}'}]},{type:"js-function",name:"is_organic_discount",_id:"58e4a4ce3a21fe20082e885c",config:[{name:"parameter",value:""},{name:"function",value:"function() {\r\n\tvar pHash = window.location.hash.substr(1);\r\n  \treturn pHash;\r\n}"}]},{type:"js-function",name:"url_decoded_image",_id:"59cb4b17d8abc63106f42a5b",config:[{value:"@image",name:"parameter"},{value:"function(image){\r\n  return decodeURIComponent(image);\r\n}",name:"function"}]},{type:"js-function",name:"personali_div",_id:"59cb440fd8abc63106f42a5a",config:[{name:"parameter",value:""},{name:"function",value:'function(){\r\n    if($("#personaliDiv").length == 0)\r\n    \treturn "#addForm .btAdd";\r\n\treturn ".personaliDiv";\r\n}'}]},{type:"js-function",name:"category_3rd_level",_id:"59d27c20d8abc63106f42a5e",config:[{name:"parameter",value:""},{name:"function",value:"function() {\r\n\ttry {\r\n\t\tif(personaliDataLayer[0].subCategory[3]) {\r\n\t\t\treturn personaliDataLayer[0].subCategory[3];\r\n\t\t}\r\n\t}\r\n\tcatch(err) {\r\n\t    return '';\r\n\t}  \r\n}"}]},{type:"data-layer",name:"usr_segment",_id:"59e8af50d8abc63106f42a71",config:[{value:"RFM",name:"var-name"}]},{type:"data-layer",name:"cdav",_id:"59f086b2d8abc63106f42a74",config:[{name:"var-name",value:"customerHasCdav"}]},{type:"js-function",name:"usr_segment_js",_id:"59f999fed8abc63106f42a79",config:[{value:"@usr_segment",name:"parameter"},{value:"function(userSegment) {\r\n\tif(!userSegment || userSegment === '') {\r\n\t\tif(tc_vars.usr_id == '') {\r\n\t\t\treturn 'NotLoggedIn'\r\n\t\t} else {\r\n\t\t\treturn 'LoggedInWithEmptySegment'\r\n\t\t}\r\n\t}\r\n\r\n\treturn userSegment;\r\n}",name:"function"}]},{type:"js-function",name:"cdav_js",_id:"59f9ba78d8abc63106f42a7a",config:[{value:"@cdav",name:"parameter"},{value:"function(cdav) {\r\n\tif(cdav) {\r\n    \treturn cdav;\r\n    } else {\r\n    \treturn 'false';\r\n    }\r\n}",name:"function"}]},{type:"js-function",name:"has_flash",_id:"59d39f3fd8abc63106f42a5f",config:[{value:"",name:"parameter"},{value:"function() {\r\n\tfunction helper() {\r\n\t\tfunction hasFlashSales() {\r\n\t\t\ttry{\r\n\t\t\t\tconst reactStore = __STORE__.getState();\r\n\t\t\t    const currentProductId = reactStore.sceneStates.product.currentFullId;\r\n\t\t\t    const productData = reactStore.entities.productDataList[currentProductId];\r\n\t\t\t    if(!productData) return false;\r\n\t\t\t    const product = productData.product;\r\n\t\t\t    const hasCommercialOperation = product && product.commercialOperations && product.commercialOperations.length > 0;\r\n\t\t\t    const hasFlashSales = hasCommercialOperation && product.commercialOperations.some(x => x.type === 'flashsale');\r\n\t\t\t  \treturn hasFlashSales;\r\n\t\t\t} catch(err) {\r\n\t \t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction pWineCount() {\r\n\t\t\ttry {\r\n\t\t\t    var pWine = $.cookies.get('pWine');\r\n\t\t\t    if(pWine != '') {\r\n\t\t\t        var pWineObj = JSON.parse(pWine);\r\n\t\t\t        var difference = new Date().getTime() - pWineObj['lastPurchaseDate'];\r\n\t\t\t        var daysDifference = Math.floor(difference/1000/60/60/24);\r\n\t\t\t        var monthsCount = parseInt(daysDifference/30);\r\n\t\t\t        return monthsCount + 1;\r\n\t\t\t    }\r\n\t\t\t} catch(err) {\r\n\t\t\t    return err.message;\r\n\t\t\t}\r\n\r\n\t\t\treturn '0';\r\n\t\t}\r\n\r\n\t\t//For Mobile\r\n\t\tif(tc_vars.env_device == 'm') {\r\n\t\t\tif(hasFlashSales()) {\r\n\t\t\t\treturn 'flash';\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\tvar flashText = $('#fpBlocPrice .red');\r\n\t\t\tif(flashText.length > 0) {\r\n\t\t\t\tif(flashText.text().trim().toLowerCase().indexOf('vente flash') > -1) {\r\n\t\t\t\t\treturn 'flash';\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn 'flash_missing_index';\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t//Return Wine Months numebr since last purchase\r\n\t\t      \tvar pWineResult = false;\r\n\t\t\t\tpWineResult = pWineCount();\r\n\t\t\t\treturn String(pWineResult);\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\treturn err.message;\r\n\t\t}\r\n\t}\r\n\r\n\ttry{\r\n\t\treturn helper();\r\n\t} catch (err) {\r\n\t\treturn err.message;\r\n\t}\t\r\n}",name:"function"}]},{type:"js-function",name:"category_2nd_level",_id:"59d27c00d8abc63106f42a5d",config:[{name:"parameter",value:""},{name:"function",value:"function() {\r\n\ttry {\r\n\t\tif(personaliDataLayer[0].subCategory[2]) {\r\n\t\t\treturn personaliDataLayer[0].subCategory[2];\r\n\t\t} else {\r\n        \treturn 'missing2ndLevelSubCategory';\r\n        }\r\n\t}\r\n\tcatch(err) {\r\n\t    return '';\r\n\t}  \r\n}"}]},{type:"js-function",name:"title_decoded",_id:"58bed8812a76f749aebc36d4",config:[{value:"",name:"parameter"},{value:'function() {\r\n\tfunction replaceAll(str, find, replace) {\r\n\t\treturn str.replace(new RegExp(find, \'g\'), replace);\r\n\t}\r\n\tvar theString = personaliDataLayer[0].productTitle;\r\n\tvar txt = document.createElement("textarea");\r\n\tvar p_title = $(txt).html(theString).text();\r\n\r\n\tp_title = replaceAll(p_title, "\'", "`");\r\n\treturn p_title;\r\n}\r\n',name:"function"}]},{type:"js-function",name:"cart_total_ajax",_id:"5a8aef964ecedd71d154ce5b",config:[{name:"parameter",value:""},{name:"function",value:"function() {\r\n\tvar jqxhr = $.ajax( \"https://www.cdiscount.com/ShoppingCartRwd/recapPanierJSon.html\" )\r\n  \t.done(function(data) {\r\n    \tvar cartTotal = data.data.total;\r\n\t\tcartTotal = cartTotal.replace('€','');\r\n      \treturn cartTotal;\r\n  \t})\r\n  \t.fail(function(data) {\r\n    \t\r\n  \t})\r\n}"}]},{type:"js-function",name:"listing_page_items",_id:"5aa7dae34ecedd71d154ce71",config:[{name:"parameter",value:""},{name:"function",value:"function(parameter) {\r\n\r\n  var items = personaliDataLayer[0].items;\r\n  var personaliItems = []; \r\n   \r\n  for(index in items) {\r\n    if(items.hasOwnProperty(index)) {\r\n      var newItem = {};\r\n      item = items[index];\r\n      \r\n      newItem.sku = item.productSku\r\n      newItem.categoryId = item.categoryId;\r\n      newItem.productPrice = item.productPrice.replace(',', '.');\r\n      newItem.productImgUrl = item.productImgUrl;\r\n      newItem.productTitle = item.productTitle;\r\n      newItem.productBrand = item.productBrand;\r\n\r\n      var cdav = personaliDataLayer[0].customerHasCdav;\r\n      if(cdav) {\r\n        newItem.flex1 = cdav;\r\n       cdav;\r\n      } else {\r\n        newItem.flex1 = 'false';        \r\n      }\r\n\r\n      newItem.flex2 = 'flash promotion need to work on it';\r\n      \r\n      var pSubCategory = '';\r\n      if(item.subCategory[2]) {\r\n        pSubCategory = item.subCategory[2];\r\n      } else {\r\n        pSubCategory = 'missing2ndLevelSubCategory';\r\n      }\r\n   \r\n      newItem.flex3 = pSubCategory;\r\n      newItem.flex4 = 'listingPage';\r\n      newItem.cartUrl = 'https://www.cdiscount.com';\r\n      newItem.element = document.querySelector('li[data-sku=\"' + item.productSku + '\"] .btAdd');\r\n      if(newItem.element == 'undefiend') {\r\n        debugger;\r\n      }\r\n      \r\n      //newItem.element = document.querySelector('.line_dispo.line_dispo_' + index);\r\n      newItem.appendType = \"insert_after\";\r\n      personaliItems.push(newItem);\r\n    }\r\n  }\r\n  return personaliItems;\r\n}"}]},{type:"js-function",name:"mssodse_cookie_add_to_cart_cookie",_id:"5aafea684ecedd71d154ce77",config:[{name:"parameter",value:""},{name:"function",value:"function() {\r\n\tfunction getCookie(name) {\r\n      var v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');\r\n      return v ? v[2] : null;\r\n\t}\r\n  \r\n  \treturn getCookie('mssodse');\r\n}"}]},{type:"js-function",name:"imagUrl_from_DOM",_id:"5a1fdc4b4ecedd71d154cdfa",config:[{value:"",name:"parameter"},{value:"function() {\r\n\tvar imageUrl = '';\r\n\tif(personaliDataLayer[0].productImgUrl) {\r\n\t\timageUrl = personaliDataLayer[0].productImgUrl;\r\n\t} else { \r\n\t\timageUrl = document.querySelector('meta[property=\"og:image\"]').content;\r\n\t}\r\n\t\r\n  return imageUrl;\r\n}",name:"function"}]},{type:"js-function",name:"imageUrl_js",_id:"5ab771964ecedd71d154ce80",config:[{value:"",name:"parameter"},{value:"function() {\r\n\tvar imageUrl = '';\r\n\tif(personaliDataLayer[0].productImgUrl) {\r\n\t\timageUrl = personaliDataLayer[0].productImgUrl;\r\n\t} else { \r\n\t\timageUrl = document.querySelector('meta[property=\"og:image\"]').content;\r\n\t}\r\n\t\r\n  return imageUrl;\r\n}",name:"function"}]},{type:"js-function",name:"page_type_eligibility",_id:"59b91772d8abc63106f42a42",config:[{name:"parameter",value:""},{name:"function",value:"function() {\r\n  var platform = 'Desktop';\r\n  if(typeof(__STORE__) == 'object') {\r\n    platform = 'Mobile';\r\n  }\r\n\r\n  if (personaliDataLayer[0].pageType == 'ProductSheet') {\r\n    if (document.querySelectorAll('a.fpSellerName').length > 0) {\r\n      return 'false';\r\n    }\r\n\r\n    if (document.querySelectorAll(\".btNegociate\").length > 0) {\r\n      return 'false';\r\n    }\r\n\r\n    if (document.querySelectorAll(\".mod-negotiate\").length > 0) {\r\n      return 'false';\r\n    }\r\n\r\n    if (document.querySelectorAll(\".ShortSeller .ShortSellerLink\").length > 0) {\r\n      return 'false';\r\n    }\r\n\r\n    //Variants on Mobile\r\n    if(document.querySelectorAll('.VariantSelect').length > 0) {\r\n      //return 'false';\r\n    }\r\n\r\n    //Variants on Desktop\r\n    if(document.querySelectorAll('.fpSizeSelector').length > 0) {\r\n      //return 'false';\r\n    }\r\n\r\n    var cdavRadioButton = document.querySelector('[value=\"DedicatedDealPrice\"]');\r\n    if(cdavRadioButton) {\r\n      if(cdavRadioButton.checked) {\r\n        return 'false';\r\n      }\r\n    }\r\n    \r\n\r\n    /* \r\n      In case the tc_vars offer id doesn't match the DOM offer id of CD\r\n    */\r\n    /*\r\n    var domOfferId = $(\"#ProductFormData_ProductPostedForm_OfferId\").val();\r\n    var tc_vars_offer_id = tc_vars.pr_offerId;\r\n    if(domOfferId != tc_vars_offer_id) {\r\n      return 'false';\r\n    } */\r\n\r\n    if(tc_vars.pr_sellerId != '0') {\r\n          return 'false';\r\n    }\r\n    \r\n    if(document.querySelectorAll(\"#fpSellBy .fpSellBy .logoCDS\").length > 0) {\r\n      var sellerName = document.querySelector(\"#fpSellBy .fpSellBy .logoCDS\").textContent;\r\n        if(sellerName != 'Cdiscount' && tc_vars.pr_sellerId != '0') {\r\n          return 'false';\r\n        }\r\n    }\r\n\r\n      if(tc_vars.env_work == 'RCT' || tc_vars.env_work == 'PREPROD') {\r\n        return 'ProductSheetRCT' + platform;\r\n      }\r\n    \r\n      return 'ProductSheet' + platform;\r\n  }\r\n\r\n  if (personaliDataLayer[0].pageType == 'ListeProduit') {\r\n    if(tc_vars.env_work == 'RCT' || tc_vars.env_work == 'PREPROD') {\r\n        return 'ListeProduitRCT' + platform;\r\n      } else {\r\n        return 'ListeProduit' + platform;\r\n      }\r\n  }\r\n}\r\n"}]}]),values=require("./lib/values")(variables),triggers=require("./lib/triggers")(values)([{type:"page-view",name:"All Pages",_id:"579886f965afeab32fc122e8",config:[{value:"all-pages",name:"fires-on"},{value:"default",name:"url-match->condition"},{value:"",name:"url-match->expected"},{value:"default",name:"variable->condition"},{value:"",name:"variable->variable"},{value:"",name:"variable->expected"}]},{type:"page-view",name:"Cart Page",_id:"57a062be65afeab32fc12306",config:[{value:"variable",name:"fires-on"},{value:"default",name:"url-match->condition"},{value:"",name:"url-match->expected"},{value:"contains",name:"variable->condition"},{value:"@page_type",name:"variable->variable"},{value:"Basket",name:"variable->expected"}]},{type:"page-view",name:"Confirmation Page",_id:"57ea30fdb9147928149160df",config:[{value:"variable",name:"fires-on"},{value:"default",name:"url-match->condition"},{value:"",name:"url-match->expected"},{value:"contains",name:"variable->condition"},{value:"@page_type",name:"variable->variable"},{value:"PurchaseConfirmation",name:"variable->expected"}]},{type:"page-view",name:"Organic Discount",_id:"58e4b1d03a21fe20082e885e",config:[{value:"variable",name:"fires-on"},{value:"default",name:"url-match->condition"},{value:"",name:"url-match->expected"},{value:"equals",name:"variable->condition"},{value:"@is_organic_discount",name:"variable->variable"},{value:"_exp=buttonOver",name:"variable->expected"}]},{type:"js-function",name:"Product Page No duplicates",_id:"5980952cd8abc63106f42a2c",config:[{name:"function",value:"function(){\r\n  if(tc_vars.env_work == 'prod') {\r\n    if(typeof(dataLayer) == 'object') {\r\n      if(typeof(dataLayer[0]) == 'object') {\r\n        if(dataLayer[0].pageType) {\r\n          var isInjected = window.personaliInjected;\r\n          var isProductPage = dataLayer[0].pageType == \"ProductSheet\";\r\n            \r\n            if(isProductPage && typeof(isInjected) == \"undefined\"){\r\n              window.personaliInjected = true;\r\n              return true;\r\n            }\r\n            else{\r\n              return false;\r\n            }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}"}]},{type:"js-function",name:"Product Page - Recette",_id:"59834a2dd8abc63106f42a2f",config:[{name:"function",value:"function(){\r\n  if(tc_vars.env_work == 'RCT') {\r\n    if(typeof(personaliDataLayer) == 'object') {\r\n      if(typeof(personaliDataLayer[0]) == 'object') {\r\n        if(personaliDataLayer[0].pageType) {\r\n          var isInjected = window.personaliInjected;\r\n          var isProductPage = personaliDataLayer[0].pageType == \"ProductSheet\";\r\n            \r\n            if(isProductPage && typeof(isInjected) == \"undefined\"){\r\n              window.personaliInjected = true;\r\n              return true;\r\n            }\r\n            else{\r\n              return false;\r\n            }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}"}]},{type:"page-view",name:"Listing Page",_id:"5aa7da6b4ecedd71d154ce6f",config:[{name:"fires-on",value:"variable"},{name:"url-match->condition",value:"default"},{name:"url-match->expected",value:""},{name:"variable->condition",value:"equals"},{name:"variable->variable",value:"@page_type_eligibility"},{name:"variable->expected",value:"ListeProduit"}]},{type:"page-view",name:"Listing Page - Recette",_id:"5aa7da7f4ecedd71d154ce70",config:[{name:"fires-on",value:"variable"},{name:"url-match->condition",value:"default"},{name:"url-match->expected",value:""},{name:"variable->condition",value:"equals"},{name:"variable->variable",value:"@page_type_eligibility"},{name:"variable->expected",value:"ListeProduitRCT"}]},{type:"page-view",name:"Product Page",_id:"57a0634065afeab32fc12307",config:[{value:"variable",name:"fires-on"},{value:"default",name:"url-match->condition"},{value:"",name:"url-match->expected"},{value:"equals",name:"variable->condition"},{value:"@page_type_eligibility",name:"variable->variable"},{value:"ProductSheetDesktop",name:"variable->expected"}]},{type:"page-view",name:"Product Page Recette",_id:"5a01b6914ecedd71d154cdde",config:[{name:"fires-on",value:"variable"},{name:"url-match->condition",value:"default"},{name:"url-match->expected",value:""},{name:"variable->condition",value:"equals"},{name:"variable->variable",value:"@page_type_eligibility"},{name:"variable->expected",value:"ProductSheetRCTDesktop"}]},{type:"page-view",name:"Product Page - Mobile",_id:"5ab76f1f4ecedd71d154ce7e",config:[{name:"fires-on",value:"variable"},{name:"url-match->condition",value:"default"},{name:"url-match->expected",value:""},{name:"variable->condition",value:"equals"},{name:"variable->variable",value:"@page_type_eligibility"},{name:"variable->expected",value:"ProductSheetMobile"}]},{type:"page-view",name:"Product Page - Mobile - Recette",_id:"5ab76f4d4ecedd71d154ce7f",config:[{name:"fires-on",value:"variable"},{name:"url-match->condition",value:"default"},{name:"url-match->expected",value:""},{name:"variable->condition",value:"equals"},{name:"variable->variable",value:"@page_type_eligibility"},{name:"variable->expected",value:"ProductSheetRCTMobile"}]}]);triggers([]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{name:"affiliate_id",value:"@affiliate_id"},{name:"authentication_key",value:"@auth_key"},{name:"environment",value:"integration"},{name:"integration_type",value:"single_product_page_make_an_offer"},{name:"multi_products_page_make_an_offer->products_array",value:""},{name:"multi_products_page_make_an_offer->event_hooks",value:""},{name:"multi_products_page_make_an_offer->selector-type",value:"default"},{name:"multi_products_page_make_an_offer->selector-path",value:""},{name:"multi_products_page_make_an_offer->append_type",value:"default"},{name:"single_product_page_make_an_offer->sku",value:"fsdf"},{name:"single_product_page_make_an_offer->category",value:"fsdfsd"},{name:"single_product_page_make_an_offer->product_brand",value:"fsdf"},{name:"single_product_page_make_an_offer->product_price",value:"322"},{name:"single_product_page_make_an_offer->product_amp",value:""},{name:"single_product_page_make_an_offer->email",value:""},{name:"single_product_page_make_an_offer->flex1",value:""},{name:"single_product_page_make_an_offer->flex2",value:""},{name:"single_product_page_make_an_offer->flex3",value:""},{name:"single_product_page_make_an_offer->flex4",value:""},{name:"single_product_page_make_an_offer->product_image_url",value:"http://www.google.com/fsd.png"},{name:"single_product_page_make_an_offer->product_title",value:"test"},{name:"single_product_page_make_an_offer->cart_url",value:"http://www.macys.com/bag/index.ognc"},{name:"single_product_page_make_an_offer->event_hooks",value:'debugger;\r\nNetotiate.Events.subscribe("netotiate.plugin.initiator.onclick", function(e, data) {\r\n                     // treat variants\r\n                     console.log("here");\r\n                 });'},{name:"single_product_page_make_an_offer->selector-type",value:"_path"},{name:"single_product_page_make_an_offer->selector-path",value:"body"},{name:"single_product_page_make_an_offer->append_type",value:"append"},{name:"confirmation_page_make_an_offer->order_id",value:""},{name:"confirmation_page_make_an_offer->items",value:""},{name:"page_type",value:"custom"},{name:"custom->custom_page_type",value:"productPage"}]))}),triggers([]).bind(function(){require("@personali/canvas-custom-sketch").init(values([{name:"html",value:'<script type="text/javascript">\r\n    (function() {\r\n        var netotiateLibraryUrl = (tc_vars[\'env_work\']=="prod")?"//static.netotiate.com/scripts/cart/checkout.library.min.js.jgz":"//static-int1.personali.io/scripts/cart/checkout.library.min.js.jgz";\r\n        var e = document.createElement(\'script\');\r\n        e.type =\'text/javascript\';\r\n        e.async = true;\r\n        e.src =netotiateLibraryUrl;\r\n        var s = document.getElementsByTagName(\'script\')[0];\r\n        s.parentNode.insertBefore(e, s);\r\n    }())\r\n\r\n    /**\r\n     * This method will be called once the Async library cart/checkout.library.min.js.jgz \r\n     * has been loaded on the page.\r\n     */\r\n    window.onNetotiateCheckoutReadyState = function() {\r\n        \r\n        // Send all products in the cart\r\n        for (var i = 0; i < tc_vars["sf_ords"].length; i++) {\r\n            for (var j = 0; j < tc_vars["sf_ords"][i]["prs"].length; j++) {\r\n                window.Netotiate.Cart.Api.Pixel.addItem(tc_vars["sf_ords"][i]["prs"][j]["pr_sku"]);\r\n            }\r\n        }\r\n        \r\n        var tfAmount = parseInt(parseFloat(tc_vars["sf_amt_tf"]).toFixed(2) * 100, 10);\r\n        \r\n        if (tc_vars["sf_netotiate_cart_reference"]) {\r\n            // Cart Rescue sale\r\n            window.Netotiate.Cart.Api.Pixel.report(132, "c8bb7e6b3440fc320d19f41710876ec8de24f4c9", tc_vars["sf_netotiate_cart_reference"], tc_vars["sf_id"], tfAmount, tc_vars["sf_prs_nb"], "netotiate");\r\n        } else {\r\n            // Organic sale\r\n            window.Netotiate.Cart.Api.Pixel.report(132, "c8bb7e6b3440fc320d19f41710876ec8de24f4c9", null, tc_vars["sf_id"], tfAmount, tc_vars["sf_prs_nb"], "organic");\r\n        }\r\n    }; \r\n<\/script>'}]))}),triggers([]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{value:"@affiliate_id",name:"affiliate_id"},{value:"@auth_key",name:"authentication_key"},{value:"integration",name:"environment"},{value:"confirmation_page_make_an_offer",name:"integration_type"},{value:"",name:"multi_products_page_make_an_offer->products_array"},{value:"",name:"multi_products_page_make_an_offer->event_hooks"},{value:"default",name:"multi_products_page_make_an_offer->selector-type"},{value:"",name:"multi_products_page_make_an_offer->selector-path"},{value:"default",name:"multi_products_page_make_an_offer->append_type"},{value:"",name:"single_product_page_make_an_offer->sku"},{value:"",name:"single_product_page_make_an_offer->category"},{value:"",name:"single_product_page_make_an_offer->product_brand"},{value:"",name:"single_product_page_make_an_offer->product_price"},{value:"",name:"single_product_page_make_an_offer->product_amp"},{value:"",name:"single_product_page_make_an_offer->email"},{value:"",name:"single_product_page_make_an_offer->flex1"},{value:"",name:"single_product_page_make_an_offer->flex2"},{value:"",name:"single_product_page_make_an_offer->flex3"},{value:"",name:"single_product_page_make_an_offer->flex4"},{value:"",name:"single_product_page_make_an_offer->product_image_url"},{value:"",name:"single_product_page_make_an_offer->product_title"},{value:"",name:"single_product_page_make_an_offer->cart_url"},{value:"",name:"single_product_page_make_an_offer->event_hooks"},{value:"default",name:"single_product_page_make_an_offer->selector-type"},{value:"",name:"single_product_page_make_an_offer->selector-path"},{value:"default",name:"single_product_page_make_an_offer->append_type"},{value:"@tracking_id",name:"confirmation_page_make_an_offer->order_id"},{value:"@pixel_data",name:"confirmation_page_make_an_offer->items"},{name:"page_type",value:"custom"},{name:"custom->custom_page_type",value:"confirmationPage"}]))}),triggers([{name:"Organic Discount"}]).bind(function(){require("@personali/canvas-custom-sketch").init(values([{value:"<script>\r\n\t$(\".netotiate-button-iframe\").detach().insertAfter('#fpAddBsk')\r\n<\/script>",name:"html"}]))}),triggers([]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{value:"@affiliate_id",name:"affiliate_id"},{value:"@auth_key",name:"authentication_key"},{value:"production",name:"environment"},{value:"1",name:"debug"},{value:"single_product_page_make_an_offer",name:"integration_type"},{value:"",name:"multi_products_page_make_an_offer->products_array"},{value:"",name:"multi_products_page_make_an_offer->event_hooks"},{value:"@sku",name:"single_product_page_make_an_offer->sku"},{value:"@categoryId",name:"single_product_page_make_an_offer->category"},{value:"@brand",name:"single_product_page_make_an_offer->product_brand"},{value:"@productPrice",name:"single_product_page_make_an_offer->product_price"},{value:"",name:"single_product_page_make_an_offer->product_amp"},{value:"",name:"single_product_page_make_an_offer->email"},{value:"@flex1",name:"single_product_page_make_an_offer->flex1"},{value:"@flex2",name:"single_product_page_make_an_offer->flex2"},{value:"",name:"single_product_page_make_an_offer->flex3"},{value:"@CDAV",name:"single_product_page_make_an_offer->flex4"},{value:"#fpAddBsk",name:"single_product_page_make_an_offer->organic_add_to_cart_button_query_selector"},{value:"@image",name:"single_product_page_make_an_offer->product_image_url"},{value:"@title_decoded",name:"single_product_page_make_an_offer->product_title"},{value:"@cartUrl",name:"single_product_page_make_an_offer->cart_url"},{value:'Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n    "waitFor": "[\'cartParams\']"\r\n});\r\n\r\nfunction pOpenArena() {\r\n    // treat variants\r\n    var productInfo = window.validateSelection();\r\n    if (productInfo.isValide) {\r\n        var cartParams = {};\r\n        cartParams[\'isValid\'] = true;\r\n        cartParams[\'quantity\'] = $(".fpQuantitySelect") ? $(".fpQuantitySelect").val() : 1;\r\n        if (productInfo) {\r\n            window.dataLayer[0].productPrice = parseFloat(productInfo.price.text().replace("€", "."));\r\n            window.dataLayer[0].sku = productInfo.sku ? productInfo.sku : window.dataLayer[0].sku;\r\n            window.dataLayer[0].productAmp = productInfo.urlMkp;\r\n        }\r\n        Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n            cartParams: JSON.stringify(cartParams),\r\n            productPrice: window.dataLayer[0].productPrice,\r\n            sku: window.dataLayer[0].sku,\r\n            productAmp: window.dataLayer[0].productAmp\r\n        })\r\n        Netotiate.Events.publish("netotiate.plugin.arena.show");\r\n    } else {\r\n        Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n            cartParams: null\r\n        });\r\n    }\r\n}\r\n\r\nNetotiate.Events.subscribe("netotiate.plugin.initiator.onclick", function(e, data) {\r\n    // treat variants\r\n    var productInfo = window.validateSelection();\r\n\r\n    if (productInfo.isValide) {\r\n        var cartParams = {};\r\n        cartParams[\'isValid\'] = true;\\\r\n        tcartParams[\'quantity\'] = $(".fpQuantitySelect") ? $(".fpQuantitySelect").val() : 1;\r\n        if (productInfo) {\r\n            window.dataLayer[0].productPrice = parseFloat(productInfo.price.text().replace("€", "."));\r\n            window.dataLayer[0].sku = productInfo.sku ? productInfo.sku : window.dataLayer[0].sku;\r\n            window.dataLayer[0].productAmp = productInfo.urlMkp;\r\n        }\r\n        Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n                cartParams: JSON.stringify(cartParams),\r\n                productPrice: window.dataLayer[0].productPrice,\r\n                sku: window.dataLayer[0].sku,\r\n                productAmp: window.dataLayer[0].productAmp\r\n            })\r\n            //Netotiate.Events.publish("netotiate.plugin.arena.show");\r\n    } else {\r\n        Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n            cartParams: null\r\n        });\r\n    }\r\n});\r\n\r\nNetotiateWindow.client.events.subscribe("netotiate.arena.exit_prompt.view", function(data) {\r\n    pOpenArena();\r\n});\r\n\r\n\r\nNetotiateWindow.client.events.subscribe("netotiate.plugin.trigger_on_exit.prompt", function(data) {\r\n    pOpenArena();\r\n});\r\n\r\nNetotiateWindow.client.events.subscribe("netotiate.plugin.auto_trigger.prompt", function(data) {\r\n    pOpenArena();\r\n});\r\n\r\nif (window.location.hash.substr(1) == \'_exp=buttonOver\') {\\\r\n    $(".netotiate-button-iframe").detach().insertAfter(\'#fpAddBsk\');\r\n}',name:"single_product_page_make_an_offer->event_hooks"},{value:"_id",name:"single_product_page_make_an_offer->selector-type"},{value:"personaliDiv",name:"single_product_page_make_an_offer->selector-path"},{value:"append",name:"single_product_page_make_an_offer->append_type"},{value:"",name:"confirmation_page_make_an_offer->order_id"},{value:"",name:"confirmation_page_make_an_offer->items"},{name:"page_type",value:"custom"},{name:"custom->custom_page_type",value:"productPage"}]))}),triggers([]).bind(function(){require("@personali/canvas-custom-sketch").init(values([{name:"html",
value:'<script type="text/javascript">\r\nwindow.onNetotiateCartReadyState = function(){\r\n  Netotiate.Cart.create({\r\n    "subtotal" : dataLayer[0].subtotal, "total" : dataLayer[0].total, "shipping" : dataLayer[0].shipping, "tax" : dataLayer[0].tax, "flex1" : dataLayer[0].flex1, "cartUrl" : dataLayer[0].cartUrl\r\n  });\r\n\r\n  var cartItems = dataLayer[0].items;\r\n  for(index in cartItems) {\r\n    if(cartItems.hasOwnProperty(index)) {\r\n        var cartItem = cartItems[index];\r\n        Netotiate.Cart.Items.add({\r\n          "productPrice" : cartItem.productPrice,\r\n          "productCategory" : cartItem.productCategory,\r\n          "productSku" : cartItem.productSku,\r\n          "productImageUrl" : cartItem.productImageUrl,\r\n          "productTitle" : cartItem.productTitle,\r\n          "productQuantity" : cartItem.productQuantity,\r\n          "productBrand" : cartItem.productBrand,\r\n          "flex1" : cartItem.flex1,\r\n          "flex2" : cartItem.flex2,\r\n          "flex3" : cartItem.flex3,\r\n          "flex4" : cartItem.flex4\r\n        });\r\n    }\r\n  }\r\n\r\n  Netotiate.Cart.collect();\r\n};\r\n\r\nvar netotiateLibraryUrl = (tc_vars[\'env_work\']=="prod")?"//static.personali.com/scripts/cart/cart.library.min.js.jgz":"//static-int1.personali.io/scripts/cart/cart.library.min.js.jgz";\r\nwindow.netotiateInitScript = function () {\r\n    Netotiate.Cart.init({\r\n      \'affiliateId\': \'132\',\r\n      \'authenticationKey\': \'c8bb7e6b3440fc320d19f41710876ec8de24f4c9\',\r\n      \'debug\': false\r\n    });\r\n  };\r\n  \r\n  (function(){\r\n    var e = document.createElement(\'script\');e.type = \'text/javascript\';e.async = true;\r\n    e.src = netotiateLibraryUrl;\r\n    var s = document.getElementsByTagName(\'script\')[0];\r\n    s.parentNode.insertBefore(e, s);\r\n  }());\r\n<\/script> '}]))}),triggers([]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{name:"affiliate_id",value:"@affiliate_id"},{name:"authentication_key",value:"@auth_key"},{name:"environment",value:"production"},{name:"integration_type",value:"confirmation_page_make_an_offer"},{name:"multi_products_page_make_an_offer->products_array",value:""},{name:"multi_products_page_make_an_offer->event_hooks",value:""},{name:"single_product_page_make_an_offer->sku",value:""},{name:"single_product_page_make_an_offer->category",value:""},{name:"single_product_page_make_an_offer->product_brand",value:""},{name:"single_product_page_make_an_offer->product_price",value:""},{name:"single_product_page_make_an_offer->product_amp",value:""},{name:"single_product_page_make_an_offer->email",value:""},{name:"single_product_page_make_an_offer->flex1",value:""},{name:"single_product_page_make_an_offer->flex2",value:""},{name:"single_product_page_make_an_offer->flex3",value:""},{name:"single_product_page_make_an_offer->flex4",value:""},{name:"single_product_page_make_an_offer->organic_add_to_cart_button_query_selector",value:""},{name:"single_product_page_make_an_offer->product_image_url",value:""},{name:"single_product_page_make_an_offer->product_title",value:""},{name:"single_product_page_make_an_offer->cart_url",value:""},{name:"single_product_page_make_an_offer->event_hooks",value:""},{name:"single_product_page_make_an_offer->selector-type",value:"default"},{name:"single_product_page_make_an_offer->selector-path",value:""},{name:"single_product_page_make_an_offer->append_type",value:"default"},{name:"confirmation_page_make_an_offer->order_id",value:""},{name:"confirmation_page_make_an_offer->items",value:""},{name:"page_type",value:"custom"},{name:"custom->custom_page_type",value:"confirmationPage"}]))}),triggers([{name:"Confirmation Page"}]).bind(function(){require("@personali/canvas-custom-sketch").init(values([{value:'<script type="text/javascript">\r\n\t/**\r\n\t * This method will be called once the Async library cart/checkout.library.min.js.jgz \r\n\t * has been loaded on the page.\r\n\t */\r\n\t/*window.onNetotiateCheckoutReadyState = function() {\r\n\t\t\r\n\t\t// Send all products in the cart\r\n\t\tfor (var i = 0; i < personaliDataLayer[0].items.length; i++) {\r\n\t\t\t\twindow.Netotiate.Cart.Api.Pixel.addItem(personaliDataLayer[0].items[i].sku);\r\n\t\t}\r\n\t\t\r\n\t\tvar tfAmount = personaliDataLayer[0].cart.tfAmount;\r\n\t\t\r\n\t\tif (personaliDataLayer[0].cart.isPersonali) {\r\n\t\t\t// Cart Rescue sale\r\n\t\t\twindow.Netotiate.Cart.Api.Pixel.report(132, "c8bb7e6b3440fc320d19f41710876ec8de24f4c9", tc_vars["sf_netotiate_cart_reference"], personaliDataLayer[0].cart.sf_id, tfAmount, tc_vars["sf_prs_nb"], "netotiate");\r\n\t\t} else {\r\n\t\t\t// Organic sale\r\n\t\t\twindow.Netotiate.Cart.Api.Pixel.report(132, "c8bb7e6b3440fc320d19f41710876ec8de24f4c9", null, personaliDataLayer[0].cart.sf_id, tfAmount, tc_vars["sf_prs_nb"], "organic");\r\n\t\t}\r\n\t};\r\n\r\n\t(function() {\r\n      \tvar netotiateLibraryUrl = (tc_vars[\'env_work\']=="prod")?"//static.personali.com/scripts/cart/checkout.library.min.js.jgz":"//static-int1.personali.io/scripts/cart/checkout.library.min.js.jgz";\r\n\t\tvar e = document.createElement(\'script\');\r\n\t\te.type =\'text/javascript\';\r\n\t\te.async = true;\r\n\t\te.src =netotiateLibraryUrl;\r\n\t\tvar s = document.getElementsByTagName(\'script\')[0];\r\n\t\ts.parentNode.insertBefore(e, s);\r\n\t}())*/\r\n  \r\n  \r\n    /**\r\n     * This method will be called once the Asych library checkout.library.min.js.jgz \r\n     * will be loaded on the page.\r\n     */\r\n//Counter For Wine Category\r\nfunction pSetCookie(cname, cvalue, exdays) {\r\n    var d = new Date();\r\n    d.setTime(d.getTime() + (exdays*24*60*60*1000));\r\n    var expires = "expires="+ d.toUTCString();\r\n    document.cookie = cname + "=" + cvalue + ";" + expires + ";domain=cdiscount.com;path=/";\r\n}\r\n\r\n\r\nfunction pGetCookie(cname) {\r\n    var name = cname + "=";\r\n    var decodedCookie = decodeURIComponent(document.cookie);\r\n    var ca = decodedCookie.split(\';\');\r\n    for(var i = 0; i <ca.length; i++) {\r\n        var c = ca[i];\r\n        while (c.charAt(0) == \' \') {\r\n            c = c.substring(1);\r\n        }\r\n        if (c.indexOf(name) == 0) {\r\n            return c.substring(name.length, c.length);\r\n        }\r\n    }\r\n    return \'\';\r\n}\r\n\r\nfunction getpWineObject() {\r\n\ttry {\r\n\t\tvar pWine = $.cookies.get(\'pWine\');\r\n\t\tif(pWine == \'\') {\r\n\t\t\tvar pWineObj = {};\r\n\t\t\tpWineObj[\'total\'] = 0;\r\n\t\t} else {\r\n\t\t\tvar pWineObj = JSON.parse(pWine);\r\n\t\t}\r\n\r\n\t} catch (e) {\r\n\t\tvar pWineObj = {};\r\n\t\tpWineObj[\'total\'] = 0;\r\n\t}\r\n\r\n\treturn pWineObj;\r\n}\r\n\r\nfunction pWineCounter(categoryId) {\r\n\tif(categoryId == 129 || categoryId == \'129\') {\r\n\t\tvar pWineObj = getpWineObject();\r\n\t\tpWineObj[\'total\'] = pWineObj[\'total\'] + 1;\r\n\t\tpWineObj[\'lastPurchaseDate\'] = new Date().getTime();\r\n\t\tpSetCookie(\'pWine\', JSON.stringify(pWineObj), 360);\r\n\t}\r\n}\r\n//Counter For Wine Category - End\r\n\r\n\r\n     \r\n    window.onNetotiatePluginCheckoutReadyState = function(){\r\n    \tfor (var i = 0; i < tc_vars["sf_ords"].length; i++) {\r\n\t        if(tc_vars["sf_ords"][i].type.toLowerCase() == \'cd\') {\r\n\t                for (var j = 0; j < tc_vars["sf_ords"][i].prs.length; j++) {\r\n                        var sku = tc_vars["sf_ords"][i].prs[j].pr_sku;\r\n                        var amount = parseInt(tc_vars[\'sf_ords\'][i].prs[j].pr_up_ati * 100);\r\n                        var quantity = tc_vars["sf_ords"][i].prs[j].pr_quantity;\r\n                        var trackingID = tc_vars["sf_ords"][i]["id"];\r\n                        var offerId = tc_vars["sf_ords"][i].prs[j].pr_netotiate_ref;\r\n                        var categoryid = (tc_vars["sf_ords"][i]["prs"][j]["pr_departmentid"]) ? tc_vars["sf_ords"][i]["prs"][j]["pr_departmentid"].substring(0, 3) : "";\r\n                        pWineCounter(categoryid);\r\n                        if(offerId && offerId != \'\') {\r\n                                window.Netotiate.Plugin.Api.Pixel.addNetotiate(offerId, sku, null, amount, quantity, trackingID, offerId);\r\n                        } else {\r\n                                window.Netotiate.Plugin.Api.Pixel.addOrganic(sku, null, amount, quantity, trackingID)\r\n                        }\r\n\t                }\r\n\t    \t}\r\n\t\t}\r\n\r\n\t\t//fire all pixels to Netotaite server\r\n\t\twindow.Netotiate.Plugin.Api.Pixel.report(132, \'c8bb7e6b3440fc320d19f41710876ec8de24f4c9\');\r\n\t\twindow.Netotiate.Plugin.Api.Pixel.clear(); \r\n\t\t\r\n    }; \r\n\r\n    var netotiateLibraryUrl = (tc_vars[\'env_work\']=="prod")?"//static.personali.com/scripts/plugin/checkout.library.min.js.jgz":"//static-int1.personali.io/scripts/plugin/checkout.library.min.js.jgz";\r\n    (function() {\r\n        var e = document.createElement(\'script\');\r\n        e.type =\'text/javascript\';\r\n        e.async = true;\r\n        e.src = netotiateLibraryUrl;\r\n        var s = document.getElementsByTagName(\'script\')[0];\r\n        s.parentNode.insertBefore(e, s);\r\n    }())\r\n<\/script>',name:"html"}]))}),triggers([{name:"Product Page Recette"}]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{value:"@affiliate_id",name:"affiliate_id"},{value:"@auth_key",name:"authentication_key"},{value:"integration",name:"environment"},{value:"1",name:"debug"},{value:"single_product_page_make_an_offer",name:"integration_type"},{value:"",name:"multi_products_page_make_an_offer->products_array"},{value:"",name:"multi_products_page_make_an_offer->event_hooks"},{value:"@sku",name:"single_product_page_make_an_offer->sku"},{value:"@categoryId",name:"single_product_page_make_an_offer->category"},{value:"@brand",name:"single_product_page_make_an_offer->product_brand"},{value:"@productPrice",name:"single_product_page_make_an_offer->product_price"},{value:"",name:"single_product_page_make_an_offer->product_amp"},{value:"",name:"single_product_page_make_an_offer->email"},{value:"@cdav_js",name:"single_product_page_make_an_offer->flex1"},{value:"",name:"single_product_page_make_an_offer->flex2"},{value:"@category_2nd_level",name:"single_product_page_make_an_offer->flex3"},{value:"@usr_segment_js",name:"single_product_page_make_an_offer->flex4"},{value:"#fpAddBsk",name:"single_product_page_make_an_offer->organic_add_to_cart_button_query_selector"},{value:"@imagUrl_from_DOM",name:"single_product_page_make_an_offer->product_image_url"},{value:"@title_decoded",name:"single_product_page_make_an_offer->product_title"},{value:"@cartUrl",name:"single_product_page_make_an_offer->cart_url"},{value:'Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n    "waitFor": "[\'cartParams\']"\r\n});\r\n\r\nfunction mobileValidateSelection() {\r\n const reactStore = __STORE__.getState();\r\n const currentProductId = reactStore.sceneStates.product.currentFullId;\r\n const productData = reactStore.entities.productDataList[currentProductId];\r\n const hasVariance = !!productData.variance && productData.variance.length > 0;\r\n const hasSelectedVariant = hasVariance && !!productData.variance[0].selectedItem;\r\n var productPrice = \'\';\r\n if(hasSelectedVariant) {\r\n    if(productData.variance[0].selectedItem.price) {\r\n        productPrice = productData.variance[0].selectedItem.price;\r\n     } else {\r\n        productPrice = productData.product.pricing.price;\r\n     }\r\n } else {\r\n    productPrice = productData.product.pricing.price;\r\n }\r\n \r\n return {\r\n    isValide: !hasVariance || hasSelectedVariant,\r\n    productPrice: productPrice,\r\n    sku: hasSelectedVariant ? productData.variance[0].selectedItem.productId : productData.product.id,\r\n    hasSelectedVariant : hasSelectedVariant\r\n };\r\n}\r\n\r\nfunction pOpenArena() {\r\n    // treat variants\r\n    if(typeof(window.validateSelection) !== "undefined" || Netotiate.Plugin.device == \'desktop\') {\r\n        var productInfo = window.validateSelection();\r\n        var desktop = true;\r\n    } else {\r\n        var productInfo = mobileValidateSelection();\r\n        var desktop = false;\r\n    }\r\n        \r\n    if (productInfo.isValide) {\r\n        if(desktop) {\r\n            var cartParams = {};\r\n            cartParams[\'isValid\'] = true;\r\n            cartParams[\'quantity\'] = $(".fpQuantitySelect") ? $(".fpQuantitySelect").val() : 1;\r\n            var domOfferId = $("#ProductFormData_ProductPostedForm_OfferId").val();\r\n            if(domOfferId == tc_vars.pr_offerId) {\r\n                cartParams[\'offerId\'] = tc_vars.pr_offerId;\r\n            } else {\r\n                cartParams[\'offerId\'] = domOfferId;\r\n            }\r\n            cartParams[\'sellerId\'] = tc_vars.pr_sellerId;\r\n\r\n            if (productInfo) {\r\n                window.personaliDataLayer[0].productPrice = parseFloat(productInfo.price.text().replace("€", "."));\r\n                window.personaliDataLayer[0].sku = productInfo.sku ? productInfo.sku : window.personaliDataLayer[0].sku;\r\n                window.personaliDataLayer[0].productAmp = productInfo.urlMkp;\r\n            }\r\n            Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n                cartParams: JSON.stringify(cartParams),\r\n                productPrice: window.personaliDataLayer[0].productPrice,\r\n                sku: window.personaliDataLayer[0].sku,\r\n                productAmp: window.personaliDataLayer[0].productAmp\r\n            })\r\n            Netotiate.Events.publish("netotiate.plugin.arena.show");\r\n        } else {\r\n            var cartParams = {};\r\n            cartParams[\'isValid\'] = true;\r\n            cartParams[\'offerId\'] = tc_vars.pr_offerId;\r\n            cartParams[\'sellerId\'] = tc_vars.pr_sellerId;\r\n\r\n            //tcartParams[\'quantity\'] = 1;\r\n            if (productInfo && productInfo.hasSelectedVariant) {\r\n                window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n                window.personaliDataLayer[0].sku = productInfo.sku ? productInfo.sku : window.personaliDataLayer[0].sku;\r\n                window.personaliDataLayer[0].productAmp = productInfo.urlMkp;\r\n            } else if (productInfo){\r\n                window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n            }\r\n            Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n                    cartParams: JSON.stringify(cartParams),\r\n                    productPrice: window.personaliDataLayer[0].productPrice,\r\n                    sku: window.personaliDataLayer[0].sku,\r\n                    productAmp: window.personaliDataLayer[0].productAmp\r\n                })\r\n        }\r\n        \r\n    } else {\r\n        Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n            cartParams: null\r\n        });\r\n    }\r\n}\r\n\r\nNetotiate.Events.subscribe("netotiate.plugin.initiator.onclick", function(e, data) {\r\n    // treat variants\r\n    if(typeof(window.validateSelection) !== "undefined"  || Netotiate.Plugin.device == \'desktop\') {\r\n        var productInfo = window.validateSelection();\r\n        var desktop = true;\r\n    } else {\r\n        var productInfo = mobileValidateSelection();\r\n        var desktop = false;\r\n    }\r\n    \r\n    if (productInfo.isValide) {\r\n        if(desktop) {\r\n            var cartParams = {};\r\n            cartParams[\'isValid\'] = true;\r\n            var domOfferId = $("#ProductFormData_ProductPostedForm_OfferId").val();\r\n            if(domOfferId == tc_vars.pr_offerId) {\r\n                cartParams[\'offerId\'] = tc_vars.pr_offerId;\r\n            } else {\r\n                cartParams[\'offerId\'] = domOfferId;\r\n            }\r\n            cartParams[\'sellerId\'] = tc_vars.pr_sellerId;\r\n            //tcartParams[\'quantity\'] = $(".fpQuantitySelect") ? $(".fpQuantitySelect").val() : 1;\r\n            if (productInfo) {\r\n                window.personaliDataLayer[0].productPrice = parseFloat(productInfo.price.text().replace("€", "."));\r\n                window.personaliDataLayer[0].sku = productInfo.sku ? productInfo.sku : window.personaliDataLayer[0].sku;\r\n                window.personaliDataLayer[0].productAmp = productInfo.urlMkp;\r\n            }\r\n            Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n                    cartParams: JSON.stringify(cartParams),\r\n                    productPrice: window.personaliDataLayer[0].productPrice,\r\n                    sku: window.personaliDataLayer[0].sku,\r\n                    productAmp: window.personaliDataLayer[0].productAmp\r\n                })\r\n                //Netotiate.Events.publish("netotiate.plugin.arena.show");\r\n\r\n        } else {\r\n            var cartParams = {};\r\n            cartParams[\'isValid\'] = true;\r\n            cartParams[\'offerId\'] = tc_vars.pr_offerId;\r\n            cartParams[\'sellerId\'] = tc_vars.pr_sellerId;\r\n            \r\n            //tcartParams[\'quantity\'] = 1;\r\n            if (productInfo && productInfo.hasSelectedVariant) {\r\n                window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n                window.personaliDataLayer[0].sku = productInfo.sku ? productInfo.sku : window.personaliDataLayer[0].sku;\r\n                window.personaliDataLayer[0].productAmp = productInfo.urlMkp;\r\n            } else if (productInfo){\r\n                window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n            }\r\n\r\n            Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n                    cartParams: JSON.stringify(cartParams),\r\n                    productPrice: window.personaliDataLayer[0].productPrice,\r\n                    sku: window.personaliDataLayer[0].sku,\r\n                    productAmp: window.personaliDataLayer[0].productAmp\r\n                })\r\n        }\r\n    } else {\r\n        Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n            cartParams: null\r\n        });\r\n    }\r\n});\r\n\r\nNetotiateWindow.client.events.subscribe("netotiate.arena.exit_prompt.view", function(data) {\r\n    pOpenArena();\r\n});\r\n\r\n\r\nNetotiateWindow.client.events.subscribe("netotiate.plugin.trigger_on_exit.prompt", function(data) {\r\n    pOpenArena();\r\n});\r\n\r\nNetotiateWindow.client.events.subscribe("netotiate.plugin.auto_trigger.prompt", function(data) {\r\n    pOpenArena();\r\n});\r\n\r\nif (window.location.hash.substr(1) == \'_exp=buttonOver\') {\r\n    $(".netotiate-button-iframe").detach().insertAfter(\'#fpAddBsk\');\r\n}\r\n\r\nif(Netotiate.Plugin.device == \'mobile\' && $("#personaliDiv div").length) {\r\n    $("#personaliDiv div").css(\'z-index\',0);\r\n}',name:"single_product_page_make_an_offer->event_hooks"},{value:"_id",name:"single_product_page_make_an_offer->selector-type"},{value:"personaliDiv",name:"single_product_page_make_an_offer->selector-path"},{value:"append",name:"single_product_page_make_an_offer->append_type"},{value:"",name:"confirmation_page_make_an_offer->order_id"},{value:"",name:"confirmation_page_make_an_offer->items"},{value:"custom",name:"page_type"},{value:"productPage",name:"custom->custom_page_type"}]))}),triggers([{name:"Product Page - Mobile - Recette"}]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{name:"affiliate_id",value:"@affiliate_id"},{name:"authentication_key",value:"@auth_key"},{name:"environment",value:"integration"},{name:"integration_type",value:"single_product_page_make_an_offer"},{name:"multi_products_page_make_an_offer->products_array",value:""},{name:"multi_products_page_make_an_offer->event_hooks",value:""},{name:"single_product_page_make_an_offer->sku",value:"@sku"},{name:"single_product_page_make_an_offer->category",value:"@categoryId"},{name:"single_product_page_make_an_offer->product_brand",value:"@brand"},{name:"single_product_page_make_an_offer->product_price",value:"@productPrice"},{name:"single_product_page_make_an_offer->product_amp",value:""},{name:"single_product_page_make_an_offer->email",value:""},{name:"single_product_page_make_an_offer->flex1",value:"@cdav_js"},{name:"single_product_page_make_an_offer->flex2",value:"@flex2"},{name:"single_product_page_make_an_offer->flex3",value:"@category_2nd_level"},{name:"single_product_page_make_an_offer->flex4",value:""},{name:"single_product_page_make_an_offer->organic_add_to_cart_button_query_selector",value:".Button.AddToCartButton-button"},{name:"single_product_page_make_an_offer->product_image_url",value:"@imageUrl_js"},{name:"single_product_page_make_an_offer->product_title",value:"@title"},{name:"single_product_page_make_an_offer->cart_url",value:"@cartUrl"},{name:"single_product_page_make_an_offer->event_hooks",value:'Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n    "waitFor": "[\'cartParams\']"\r\n});\r\n\r\nfunction mobileValidateSelection() {\r\n const reactStore = __STORE__.getState();\r\n const currentProductId = reactStore.sceneStates.product.currentFullId;\r\n const productData = reactStore.entities.productDataList[currentProductId];\r\n const hasVariance = !!productData.variance && productData.variance.length > 0;\r\n const hasSelectedVariant = hasVariance && !!productData.variance[0].selectedItem;\r\n var productPrice = \'\';\r\n var selectedOfferId = \'\';\r\n if(hasSelectedVariant) {\r\n    if(productData.variance[0].selectedItem.price) {\r\n        productPrice = productData.variance[0].selectedItem.price;\r\n        selectedOfferId = productData.variance[0].selectedItem.offerId;\r\n     } else {\r\n        productPrice = productData.product.pricing.price;\r\n        selectedOfferId = productData.product.offerId;\r\n     }\r\n } else {\r\n    productPrice = productData.product.pricing.price;\r\n    selectedOfferId = productData.product.offerId;\r\n }\r\n \r\n return {\r\n    isValide: !hasVariance || hasSelectedVariant,\r\n    productPrice: productPrice,\r\n    sku: hasSelectedVariant ? productData.variance[0].selectedItem.productId : productData.product.id,\r\n    hasSelectedVariant : hasSelectedVariant,\r\n    selectedOfferId : selectedOfferId\r\n };\r\n}\r\n\r\nNetotiate.Events.subscribe("netotiate.plugin.initiator.onclick", function(e, data) {\r\n    // treat variants\r\n    var productInfo = mobileValidateSelection();\r\n    var desktop = false;\r\n        \r\n    if (productInfo.isValide) {\r\n        var cartParams = {};\r\n        cartParams[\'isValid\'] = true;\r\n        cartParams[\'offerId\'] = productInfo.selectedOfferId + "";\r\n        cartParams[\'sellerId\'] = tc_vars.pr_sellerId;\r\n        \r\n        //tcartParams[\'quantity\'] = 1;\r\n        if (productInfo && productInfo.hasSelectedVariant) {\r\n            window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n            window.personaliDataLayer[0].sku = productInfo.sku ? productInfo.sku : window.personaliDataLayer[0].sku;\r\n            window.personaliDataLayer[0].productAmp = productInfo.urlMkp;\r\n        } else if (productInfo){\r\n            window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n        }\r\n\r\n        Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n                cartParams: JSON.stringify(cartParams),\r\n                productPrice: window.personaliDataLayer[0].productPrice,\r\n                sku: window.personaliDataLayer[0].sku,\r\n                productAmp: window.personaliDataLayer[0].productAmp\r\n            })\r\n    } else {\r\n        Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n            cartParams: null\r\n        });\r\n    }\r\n});\r\n\r\nif(Netotiate.Plugin.device == \'mobile\' && document.querySelectorAll("#personaliDiv div").length > 0) {\r\n\tdocument.querySelector("#personaliDiv div").style.zIndex = 0;\r\n}'},{name:"single_product_page_make_an_offer->selector-type",value:"_id"},{name:"single_product_page_make_an_offer->selector-path",value:"personaliDiv"},{name:"single_product_page_make_an_offer->append_type",value:"append"},{name:"confirmation_page_make_an_offer->order_id",value:""},{name:"confirmation_page_make_an_offer->items",value:""},{name:"page_type",value:"custom"},{name:"custom->custom_page_type",value:"productPage"}]))}),triggers([{name:"Product Page - Mobile"}]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{name:"affiliate_id",value:"@affiliate_id"},{name:"authentication_key",value:"@auth_key"},{name:"environment",value:"production"},{name:"integration_type",value:"single_product_page_make_an_offer"},{name:"multi_products_page_make_an_offer->products_array",value:""},{name:"multi_products_page_make_an_offer->event_hooks",value:""},{name:"single_product_page_make_an_offer->sku",value:"@sku"},{name:"single_product_page_make_an_offer->category",value:"@categoryId"},{name:"single_product_page_make_an_offer->product_brand",value:"@brand"},{name:"single_product_page_make_an_offer->product_price",value:"@productPrice"},{name:"single_product_page_make_an_offer->product_amp",value:""},{name:"single_product_page_make_an_offer->email",value:""},{name:"single_product_page_make_an_offer->flex1",value:"@cdav_js"},{name:"single_product_page_make_an_offer->flex2",value:"@flex2"},{name:"single_product_page_make_an_offer->flex3",value:"@category_2nd_level"},{name:"single_product_page_make_an_offer->flex4",value:""},{name:"single_product_page_make_an_offer->organic_add_to_cart_button_query_selector",value:".Button.AddToCartButton-button"},{name:"single_product_page_make_an_offer->product_image_url",value:"@imageUrl_js"},{name:"single_product_page_make_an_offer->product_title",value:"@title"},{name:"single_product_page_make_an_offer->cart_url",value:"@cartUrl"},{name:"single_product_page_make_an_offer->event_hooks",value:'Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n    "waitFor": "[\'cartParams\']"\r\n});\r\n\r\nfunction mobileValidateSelection() {\r\n const reactStore = __STORE__.getState();\r\n const currentProductId = reactStore.sceneStates.product.currentFullId;\r\n const productData = reactStore.entities.productDataList[currentProductId];\r\n const hasVariance = !!productData.variance && productData.variance.length > 0;\r\n const hasSelectedVariant = hasVariance && !!productData.variance[0].selectedItem;\r\n var productPrice = \'\';\r\n var selectedOfferId = \'\';\r\n if(hasSelectedVariant) {\r\n    if(productData.variance[0].selectedItem.price) {\r\n        productPrice = productData.variance[0].selectedItem.price;\r\n        selectedOfferId = productData.variance[0].selectedItem.offerId;\r\n     } else {\r\n        productPrice = productData.product.pricing.price;\r\n        selectedOfferId = productData.product.offerId;\r\n     }\r\n } else {\r\n    productPrice = productData.product.pricing.price;\r\n    selectedOfferId = productData.product.offerId;\r\n }\r\n \r\n return {\r\n    isValide: !hasVariance || hasSelectedVariant,\r\n    productPrice: productPrice,\r\n    sku: hasSelectedVariant ? productData.variance[0].selectedItem.productId : productData.product.id,\r\n    hasSelectedVariant : hasSelectedVariant,\r\n    selectedOfferId : selectedOfferId\r\n };\r\n}\r\n\r\nNetotiate.Events.subscribe("netotiate.plugin.initiator.onclick", function(e, data) {\r\n    // treat variants\r\n    var productInfo = mobileValidateSelection();\r\n    var desktop = false;\r\n        \r\n    if (productInfo.isValide) {\r\n        var cartParams = {};\r\n        cartParams[\'isValid\'] = true;\r\n        cartParams[\'offerId\'] = productInfo.selectedOfferId + "";\r\n        cartParams[\'sellerId\'] = tc_vars.pr_sellerId;\r\n        \r\n        //tcartParams[\'quantity\'] = 1;\r\n        if (productInfo && productInfo.hasSelectedVariant) {\r\n            window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n            window.personaliDataLayer[0].sku = productInfo.sku ? productInfo.sku : window.personaliDataLayer[0].sku;\r\n            window.personaliDataLayer[0].productAmp = productInfo.urlMkp;\r\n        } else if (productInfo){\r\n            window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n        }\r\n\r\n        Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n                cartParams: JSON.stringify(cartParams),\r\n                productPrice: window.personaliDataLayer[0].productPrice,\r\n                sku: window.personaliDataLayer[0].sku,\r\n                productAmp: window.personaliDataLayer[0].productAmp\r\n            })\r\n    } else {\r\n        Netotiate.Events.publish("netotiate.plugin.options.update", {\r\n            cartParams: null\r\n        });\r\n    }\r\n});\r\n\r\nif(Netotiate.Plugin.device == \'mobile\' && document.querySelectorAll("#personaliDiv div").length > 0) {\r\n    document.querySelector("#personaliDiv div").style.zIndex = 0;\r\n}'},{name:"single_product_page_make_an_offer->selector-type",value:"_id"},{name:"single_product_page_make_an_offer->selector-path",value:"personaliDiv"},{name:"single_product_page_make_an_offer->append_type",value:"append"},{name:"confirmation_page_make_an_offer->order_id",value:""},{name:"confirmation_page_make_an_offer->items",value:""},{name:"page_type",value:"custom"},{name:"custom->custom_page_type",value:"productPage"}]))}),triggers([{name:"Listing Page - Recette"}]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{name:"affiliate_id",value:"@affiliate_id"},{name:"authentication_key",value:"@auth_key"},{name:"environment",value:"integration"},{name:"integration_type",value:"multi_products_page_make_an_offer"},{name:"multi_products_page_make_an_offer->products_array",value:"@listing_page_items"},{name:"multi_products_page_make_an_offer->event_hooks",value:""},{name:"single_product_page_make_an_offer->sku",value:""},{name:"single_product_page_make_an_offer->category",value:""},{name:"single_product_page_make_an_offer->product_brand",value:""},{name:"single_product_page_make_an_offer->product_price",value:""},{name:"single_product_page_make_an_offer->product_amp",value:""},{name:"single_product_page_make_an_offer->email",value:""},{name:"single_product_page_make_an_offer->flex1",value:""},{name:"single_product_page_make_an_offer->flex2",value:""},{name:"single_product_page_make_an_offer->flex3",value:""},{name:"single_product_page_make_an_offer->flex4",value:""},{name:"single_product_page_make_an_offer->organic_add_to_cart_button_query_selector",value:""},{name:"single_product_page_make_an_offer->product_image_url",value:""},{name:"single_product_page_make_an_offer->product_title",value:""},{name:"single_product_page_make_an_offer->cart_url",value:""},{name:"single_product_page_make_an_offer->event_hooks",value:""},{name:"single_product_page_make_an_offer->selector-type",value:"default"},{name:"single_product_page_make_an_offer->selector-path",value:""},{name:"single_product_page_make_an_offer->append_type",value:"default"},{name:"confirmation_page_make_an_offer->order_id",value:""},{name:"confirmation_page_make_an_offer->items",value:""},{name:"page_type",value:"custom"},{name:"custom->custom_page_type",value:"listingPage"}]))}),triggers([{name:"Product Page"}]).bind(function(){require("@personali/canvas-make-an-offer2").init(values([{name:"affiliate_id",value:"@affiliate_id"},{name:"authentication_key",value:"@auth_key"},{name:"environment",value:"production"},{name:"debug",value:"1"},{name:"integration_type",value:"single_product_page_make_an_offer"},{name:"multi_products_page_make_an_offer->products_array",value:""},{name:"multi_products_page_make_an_offer->event_hooks",value:""},{name:"single_product_page_make_an_offer->sku",value:"@sku"},{name:"single_product_page_make_an_offer->category",value:"@categoryId"},{name:"single_product_page_make_an_offer->product_brand",value:"@brand"},{
name:"single_product_page_make_an_offer->product_price",value:"@productPrice"},{name:"single_product_page_make_an_offer->product_amp",value:""},{name:"single_product_page_make_an_offer->email",value:""},{name:"single_product_page_make_an_offer->flex1",value:"@cdav_js"},{name:"single_product_page_make_an_offer->flex2",value:"@has_flash"},{name:"single_product_page_make_an_offer->flex3",value:"@category_2nd_level"},{name:"single_product_page_make_an_offer->flex4",value:"@mssodse_cookie_add_to_cart_cookie"},{name:"single_product_page_make_an_offer->organic_add_to_cart_button_query_selector",value:"#fpAddBsk"},{name:"single_product_page_make_an_offer->product_image_url",value:"@imageUrl_js"},{name:"single_product_page_make_an_offer->product_title",value:"@title_decoded"},{name:"single_product_page_make_an_offer->cart_url",value:"@cartUrl"},{name:"single_product_page_make_an_offer->event_hooks",value:"Netotiate.Events.publish(\"netotiate.plugin.options.update\", {\r\n    \"waitFor\": \"['cartParams']\"\r\n});\r\n\r\nvar pSelector = document.querySelectorAll('.fpColDedicatedDeal input.jsFpDedicatedDealRadio');\r\nfor (var i = 0; i < pSelector.length; i++) {\r\n    pSelector[i].addEventListener('click', function(event) {\r\n\t\tif(this.value == 'DedicatedDealPrice') {\r\n\t\t\tdocument.getElementsByClassName('netotiate-button-iframe')[0].style.display = 'none';\r\n\t\t} else {\r\n\t\t\tdocument.getElementsByClassName('netotiate-button-iframe')[0].style.display = 'block';\r\n\t\t}\r\n    });\r\n}\r\n\r\nfunction mobileValidateSelection() {\r\n const reactStore = __STORE__.getState();\r\n const currentProductId = reactStore.sceneStates.product.currentFullId;\r\n const productData = reactStore.entities.productDataList[currentProductId];\r\n const hasVariance = !!productData.variance && productData.variance.length > 0;\r\n const hasSelectedVariant = hasVariance && !!productData.variance[0].selectedItem;\r\n var productPrice = '';\r\n if(hasSelectedVariant) {\r\n    if(productData.variance[0].selectedItem.price) {\r\n        productPrice = productData.variance[0].selectedItem.price;\r\n     } else {\r\n        productPrice = productData.product.pricing.price;\r\n     }\r\n } else {\r\n    productPrice = productData.product.pricing.price;\r\n }\r\n \r\n return {\r\n    isValide: !hasVariance || hasSelectedVariant,\r\n    productPrice: productPrice,\r\n    sku: hasSelectedVariant ? productData.variance[0].selectedItem.productId : productData.product.id,\r\n    hasSelectedVariant : hasSelectedVariant\r\n };\r\n}\r\n\r\nfunction pOpenArena() {\r\n    // treat variants\r\n    if(typeof(window.validateSelection) !== \"undefined\" || Netotiate.Plugin.device == 'desktop') {\r\n        var productInfo = window.validateSelection();\r\n        var desktop = true;\r\n    } else {\r\n        var productInfo = mobileValidateSelection();\r\n        var desktop = false;\r\n    }\r\n        \r\n    if (productInfo.isValide) {\r\n        if(desktop) {\r\n            var cartParams = {};\r\n            cartParams['isValid'] = true;\r\n            cartParams['quantity'] = $(\".fpQuantitySelect\") ? $(\".fpQuantitySelect\").val() : 1;\r\n            var domOfferId = $(\"#ProductFormData_ProductPostedForm_OfferId\").val();\r\n            if(domOfferId == tc_vars.pr_offerId) {\r\n                cartParams['offerId'] = tc_vars.pr_offerId;\r\n            } else {\r\n                cartParams['offerId'] = domOfferId;\r\n            }\r\n            cartParams['sellerId'] = tc_vars.pr_sellerId;\r\n\r\n            if (productInfo) {\r\n                window.personaliDataLayer[0].productPrice = parseFloat(productInfo.price.text().replace(\"€\", \".\"));\r\n                window.personaliDataLayer[0].sku = productInfo.sku ? productInfo.sku : window.personaliDataLayer[0].sku;\r\n                window.personaliDataLayer[0].productAmp = productInfo.urlMkp;\r\n            }\r\n            Netotiate.Events.publish(\"netotiate.plugin.options.update\", {\r\n                cartParams: JSON.stringify(cartParams),\r\n                productPrice: window.personaliDataLayer[0].productPrice,\r\n                sku: window.personaliDataLayer[0].sku,\r\n                productAmp: window.personaliDataLayer[0].productAmp\r\n            })\r\n            Netotiate.Events.publish(\"netotiate.plugin.arena.show\");\r\n        } else {\r\n            var cartParams = {};\r\n            cartParams['isValid'] = true;\r\n            cartParams['offerId'] = tc_vars.pr_offerId;\r\n            cartParams['sellerId'] = tc_vars.pr_sellerId;\r\n\r\n            //tcartParams['quantity'] = 1;\r\n            if (productInfo && productInfo.hasSelectedVariant) {\r\n                window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n                window.personaliDataLayer[0].sku = productInfo.sku ? productInfo.sku : window.personaliDataLayer[0].sku;\r\n                window.personaliDataLayer[0].productAmp = productInfo.urlMkp;\r\n            } else if (productInfo){\r\n                window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n            }\r\n            Netotiate.Events.publish(\"netotiate.plugin.options.update\", {\r\n                    cartParams: JSON.stringify(cartParams),\r\n                    productPrice: window.personaliDataLayer[0].productPrice,\r\n                    sku: window.personaliDataLayer[0].sku,\r\n                    productAmp: window.personaliDataLayer[0].productAmp\r\n                })\r\n        }\r\n        \r\n    } else {\r\n        Netotiate.Events.publish(\"netotiate.plugin.options.update\", {\r\n            cartParams: null\r\n        });\r\n    }\r\n}\r\n\r\nNetotiate.Events.subscribe(\"netotiate.plugin.initiator.onclick\", function(e, data) {\r\n    // treat variants\r\n    if(typeof(window.validateSelection) !== \"undefined\"  || Netotiate.Plugin.device == 'desktop') {\r\n        var productInfo = window.validateSelection();\r\n        var desktop = true;\r\n    } else {\r\n        var productInfo = mobileValidateSelection();\r\n        var desktop = false;\r\n    }\r\n    \r\n    if (productInfo.isValide) {\r\n        if(desktop) {\r\n            var cartParams = {};\r\n            cartParams['isValid'] = true;\r\n            var domOfferId = $(\"#ProductFormData_ProductPostedForm_OfferId\").val();\r\n            if(domOfferId == tc_vars.pr_offerId) {\r\n                cartParams['offerId'] = tc_vars.pr_offerId;\r\n            } else {\r\n                cartParams['offerId'] = domOfferId;\r\n            }\r\n            cartParams['sellerId'] = tc_vars.pr_sellerId;\r\n            //tcartParams['quantity'] = $(\".fpQuantitySelect\") ? $(\".fpQuantitySelect\").val() : 1;\r\n            if (productInfo) {\r\n                window.personaliDataLayer[0].productPrice = parseFloat(productInfo.price.text().replace(\"€\", \".\"));\r\n                window.personaliDataLayer[0].sku = productInfo.sku ? productInfo.sku : window.personaliDataLayer[0].sku;\r\n                window.personaliDataLayer[0].productAmp = productInfo.urlMkp;\r\n            }\r\n            Netotiate.Events.publish(\"netotiate.plugin.options.update\", {\r\n                    cartParams: JSON.stringify(cartParams),\r\n                    productPrice: window.personaliDataLayer[0].productPrice,\r\n                    sku: window.personaliDataLayer[0].sku,\r\n                    productAmp: window.personaliDataLayer[0].productAmp\r\n                })\r\n                //Netotiate.Events.publish(\"netotiate.plugin.arena.show\");\r\n\r\n        } else {\r\n            var cartParams = {};\r\n            cartParams['isValid'] = true;\r\n            cartParams['offerId'] = tc_vars.pr_offerId;\r\n            cartParams['sellerId'] = tc_vars.pr_sellerId;\r\n            \r\n            //tcartParams['quantity'] = 1;\r\n            if (productInfo && productInfo.hasSelectedVariant) {\r\n                window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n                window.personaliDataLayer[0].sku = productInfo.sku ? productInfo.sku : window.personaliDataLayer[0].sku;\r\n                window.personaliDataLayer[0].productAmp = productInfo.urlMkp;\r\n            } else if (productInfo){\r\n                window.personaliDataLayer[0].productPrice = productInfo.productPrice;\r\n            }\r\n\r\n            Netotiate.Events.publish(\"netotiate.plugin.options.update\", {\r\n                    cartParams: JSON.stringify(cartParams),\r\n                    productPrice: window.personaliDataLayer[0].productPrice,\r\n                    sku: window.personaliDataLayer[0].sku,\r\n                    productAmp: window.personaliDataLayer[0].productAmp\r\n                })\r\n        }\r\n    } else {\r\n        Netotiate.Events.publish(\"netotiate.plugin.options.update\", {\r\n            cartParams: null\r\n        });\r\n    }\r\n});\r\n\r\nNetotiateWindow.client.events.subscribe(\"netotiate.arena.exit_prompt.view\", function(data) {\r\n\tif($(\"input[value='DedicatedDealPrice']:checked\").length == 0) {\r\n\t\tpOpenArena();\r\n\t}\r\n});\r\n\r\n\r\nNetotiateWindow.client.events.subscribe(\"netotiate.plugin.trigger_on_exit.prompt\", function(data) {\r\n    if($(\"input[value='DedicatedDealPrice']:checked\").length == 0) {\r\n\t\tpOpenArena();\r\n\t}\r\n});\r\n\r\nNetotiateWindow.client.events.subscribe(\"netotiate.plugin.auto_trigger.prompt\", function(data) {\r\n    if($(\"input[value='DedicatedDealPrice']:checked\").length == 0) {\r\n\t\tpOpenArena();\r\n\t}\r\n});\r\n\r\nif (window.location.hash.substr(1) == '_exp=buttonOver') {\r\n    $(\".netotiate-button-iframe\").detach().insertAfter('#fpAddBsk');\r\n}\r\n\r\nif(Netotiate.Plugin.device == 'mobile' && $(\"#personaliDiv div\").length) {\r\n    $(\"#personaliDiv div\").css('z-index',0);\r\n}\r\n\r\nsetInterval(function(){ \r\n    if($(\"input[value='DedicatedDealPrice']:checked\").length == 0) {\r\n        $(\".netotiate-button-iframe\").css('display' , 'block');\r\n    } else {\r\n        $(\".netotiate-button-iframe\").css('display' , 'none');\r\n    }\r\n}, 500);\r\n"},{name:"single_product_page_make_an_offer->selector-type",value:"_id"},{name:"single_product_page_make_an_offer->selector-path",value:"personaliDiv"},{name:"single_product_page_make_an_offer->append_type",value:"append"},{name:"confirmation_page_make_an_offer->order_id",value:""},{name:"confirmation_page_make_an_offer->items",value:""},{name:"page_type",value:"custom"},{name:"custom->custom_page_type",value:"productPage"}]))});
},{"./lib/triggers":4,"./lib/values":8,"./lib/variables":9,"@personali/canvas-custom-sketch":1,"@personali/canvas-make-an-offer2":2}],4:[function(require,module,exports){
var PageViewQueue=require("./triggers/page-view"),CustomEventQueue=require("./triggers/custom-event"),JSFunctionQueue=require("./triggers/js-function");module.exports=function(e){return function(u){var n={};for(var r in u)if(u.hasOwnProperty(r)){var t=u[r];n[t.name]=t}return function(u){var r=[];return r.bind=function(r){var t=new PageViewQueue(r),i=new CustomEventQueue(r),a=new JSFunctionQueue(r);for(var o in u)if(u.hasOwnProperty(o)){var c=n[u[o].name];switch(c.type){case"page-view":t.push(e(c.config));break;case"custom-event":i.push(e(c.config));break;case"js-function":a.push(e(c.config))}}t.execute(),i.execute(),a.execute()},r}}};

},{"./triggers/custom-event":5,"./triggers/js-function":6,"./triggers/page-view":7}],5:[function(require,module,exports){
(function (global){
function bind(n,e){global.document.addEventListener,global.document.addEventListener(n.get("event-name"),function(){e()})}var docReady=require("@personali/doc-ready");module.exports=function(n){var e=[];this.push=function(n){e.push(n)},this.execute=function(){docReady(function(){for(var o=null;o=e.pop();)bind(o,n)})}};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"@personali/doc-ready":10}],6:[function(require,module,exports){
function bind(triggerValues,callback){function test(){1==trigger()?callback():setTimeout(function(){test()},100)}var trigger=eval("("+triggerValues.get("function")+")");"function"==typeof trigger&&test()}module.exports=function(t){var e=[];this.push=function(t){e.push(t)},this.execute=function(){for(var n=null;n=e.pop();)bind(n,t)}};

},{}],7:[function(require,module,exports){
function assert(e,t,r){if(null==e||void 0==e)return!1;switch(t){case"regular-expression":return e.match(r);case"starts-with":return e.startsWith(r);case"ends-with":return e.endsWith(r);case"contains":return e.indexOf(r)>-1;case"equals":return e==r}}function test(e){switch(e.get("fires-on")){case"url-match":return assert(window.location.pathname,e.get("url-match->condition"),e.get("url-match->expected"));case"variable":return assert(e.get("variable->variable"),e.get("variable->condition"),e.get("variable->expected"));case"all-pages":return!0}return!1}var docReady=require("@personali/doc-ready");module.exports=function(e){var t=[];this.push=function(e){t.push(e)},this.execute=function(){docReady(function(){for(var r=null;r=t.pop();)if(test(r)){e();break}})}};
},{"@personali/doc-ready":10}],8:[function(require,module,exports){
module.exports=function(r){return function(e){var n={};for(var t in e)if(e.hasOwnProperty(t)){var u=e[t];n[u.name]=u}var a={};return a.get=function(e){var t=n[e];return t?"string"==typeof t.value&&"@"==t.value.charAt(0)?r.get(t.value.substr(1)):t.value:null},a}};

},{}],9:[function(require,module,exports){
function getCookie(e){for(var a=e+"=",r=document.cookie.split(";"),t=0;t<r.length;t++){for(var n=r[t];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(a))return n.substring(a.length,n.length)}return""}var getUrlParam=function(e){var a=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null==a?null:a[1]||0},globalJsVar=function(values){try{return eval(values.get("var-name"))}catch(e){return null}},dataLayerVar=function(values){var dataLayer=document.getElementById("canvas-script").getAttribute("dl")||"dataLayer";if(!window[dataLayer])return null;for(var variableName=values.get("var-name"),variableVal=null,i=window[dataLayer].length;i-- >0;){var obj=window[dataLayer][i],dotParts="";try{variableName.indexOf(".")>=0?(dotParts=variableName.split(".",2),variableVal=eval("window[dataLayer][i][dotParts[0]]."+dotParts[1])):variableVal=window[dataLayer][i][variableName]}catch(e){}if(variableVal)return variableVal}return null},domElementVar=function(e){var a;switch(e.get("selector-type")){case"_id":a=document.querySelector("#"+e.get("selector-path"));break;case"_class":a=document.querySelector("."+e.get("selector-path"));break;case"_path":a=document.querySelector(e.get("selector-path"))}return a?e.get("attribute")?a.getAttribute(e.get("attribute")):a.innerText:null},cookieVar=function(e){return getCookie(e.get("cookie-name"))},urlParamVar=function(e){return getUrlParam(e.get("parameter"))},jsFunctionVar=function(values){try{var callback=eval("("+values.get("function")+")");return"function"==typeof callback?callback(values.get("parameter")):null}catch(e){return null}};module.exports=function(e){var a={};for(var r in e)if(e.hasOwnProperty(r)){var t=e[r];a[t.name]=t}var n={};return n.get=function(e){var r=require("./values")(n),t=a[e];switch(t.type){case"global-js":return globalJsVar(r(t.config));case"data-layer":return dataLayerVar(r(t.config));case"dom-element":return domElementVar(r(t.config));case"js-function":return jsFunctionVar(r(t.config));case"cookie":return cookieVar(r(t.config));case"url-parameter":return urlParamVar(r(t.config));case"constant":return r(t.config).get("value")}},n};
},{"./values":8}],10:[function(require,module,exports){
function docReady(e){var t=!1,d=!0,n=window.document,a=n.documentElement,o=n.addEventListener?"addEventListener":"attachEvent",c=n.addEventListener?"removeEventListener":"detachEvent",l=n.addEventListener?"":"on",r=function(d){"readystatechange"==d.type&&"complete"!=n.readyState||(("load"==d.type?window:n)[c](l+d.type,r,!1),!t&&(t=!0)&&e.call(window,d.type||d))},i=function(){try{a.doScroll("left")}catch(e){return void setTimeout(i,50)}r("poll")};if("complete"==n.readyState)e.call(window,"lazy");else{if(n.createEventObject&&a.doScroll){try{d=!window.frameElement}catch(e){}d&&i()}n[o](l+"DOMdocReady",r,!1),n[o](l+"readystatechange",r,!1),window[o](l+"load",r,!1)}}module.exports=docReady;
},{}]},{},[3]);
